"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9281],{51318:(e,t,n)=>{n.d(t,{A5:()=>es,A6:()=>Q,OL:()=>e9,Og:()=>np,QD:()=>ee,W2:()=>Z,WR:()=>nr,Wx:()=>V,XI:()=>H,fL:()=>J,hG:()=>nm,pq:()=>nl,qm:()=>X,tq:()=>eo,v$:()=>ec,xA:()=>U,xt:()=>I,zz:()=>ny});var i=n(95155),r=n(12933),o=n(12115),a=n(3826),s=n(42070),l=n(28944),c=n(60245),d=n(86380),h=n(30208),p=n(4293),u=n(80898),f=n(60867),g=n(69404),y=n(20389),m=n(29147),k=n(44482),v=n(20350),b=n(57480),x=n(11245),_=n(89722),E=n(69648),w=n(91656),B=n(86583),T=n(48973),S=n(23406),A=n(82523),N=n(70954),P=n(21428),K=n(68704),O=n(3981),C=n(28547),z=n(76092),D=n(57195),$=n(42284),j=n(46295);function M(e){if(!e)throw Error("Parameter 'portabletextType' missing (required)");let t=e.of?.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!t)throw Error("Block type is not defined in this schema (required)");let n=t.fields?.find(e=>"children"===e.name);if(!n)throw Error("Children field for block type found in schema (required)");let i=n.type.of;if(!i)throw Error("Valid types for block children not found in schema (required)");let r=i.find(e=>"span"===e.name);if(!r)throw Error("Span type not found in schema (required)");let o=i.filter(e=>"span"!==e.name)||[],a=e.of?.filter(e=>e.name!==t.name)||[];return{styles:function(e){let t=e.fields?.find(e=>"style"===e.name);if(!t)throw Error("A field with name 'style' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list?.filter(e=>e.value);if(!n||0===n.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return n}(t),decorators:r.decorators,lists:function(e){let t=e.fields?.find(e=>"listItem"===e.name);if(!t)throw Error("A field with name 'listItem' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list.filter(e=>e.value);if(!n)throw Error("The list field need at least to be an empty array");return n}(t),block:t,span:r,portableText:e,inlineObjects:o,blockObjects:a,annotations:r.annotations}}let G="sanity-pte:";function I(e){let t=`${G}${e}`;return l&&l.enabled(t)?l(t):l(G)}function L(e,t,n){let i;let r=[e.path[0]];if(!t)return null;let o=t[r[0]];if(!o)return null;let a=[{_key:o._key}];if(o._type!==n.block.name)return a;let s=e.path.slice(0,2),l=Array.isArray(o.children)&&o.children[s[1]];return l&&(i=["children",{_key:l._key}]),i?[...a,...i]:a}function R(e,t){if(!t)return[];let[n,i]=Array.from(d.KE.nodes(t,{at:[],match:t=>(0,y.tA)(e[0])&&t._key===e[0]._key}))[0]||[void 0,void 0];if(!n||!d.Hg.isElement(n))return[];if(t.isVoid(n))return[i[0],0];let r=[e[2]],o=n.children.findIndex(e=>c([{_key:e._key}],r));if(o>=0&&n.children[o]){let e=n.children[o];return d.Hg.isElement(e)&&t.isVoid(e)?i.concat(o).concat(0):i.concat(o)}return[i[0],0]}function U(e,t,n){if(!t)return null;let i=null,r=null,o=t.anchor&&L(t.anchor,e,n);o&&t.anchor&&(i={path:o,offset:t.anchor.offset});let a=t.focus&&L(t.focus,e,n);a&&t.focus&&(r={path:a,offset:t.focus.offset});let s=!!(d.Q6.isRange(t)&&d.Q6.isBackward(t));return i&&r?{anchor:i,focus:r,backward:s}:null}function V(e,t){if(!e||!t)return null;let n={path:R(e.anchor.path,t),offset:e.anchor.offset},i={path:R(e.focus.path,t),offset:e.focus.offset};return 0===i.path.length||0===n.path.length?null:n&&i?{anchor:n,focus:i}:null}function J(e,t){let n=d.bR.transform(e.anchor,t),i=d.bR.transform(e.focus,t);return null===n||null===i?null:d.bR.equals(n,e.anchor)&&d.bR.equals(i,e.focus)?e:{anchor:n,focus:i}}l(G);let W="void-child";function Y(e,t){let n=t[e._key];return n&&c(e,n)?n:(t[e._key]=e,e)}function q(e,{schemaTypes:t},n={}){return e&&Array.isArray(e)?e.map(e=>{let{_type:i,_key:r,...o}=e;if(e&&e._type===t.block.name){let a=!1,s=typeof e.style>"u",l=typeof e.markDefs>"u",c=typeof e.children>"u",h=(e.children||[]).map(e=>{let{_type:t,_key:i,...r}=e;return"span"!==t?(a=!0,Y({_type:t,_key:i,children:[{_key:W,_type:"span",text:"",marks:[]}],value:r,__inline:!0},n)):e});return!s&&!l&&!c&&!a&&d.Hg.isElement(e)?e:(s&&(o.style=t.styles[0].value),Y({_type:i,_key:r,...o,children:h},n))}return Y({_type:i,_key:r,children:[{_key:W,_type:"span",text:"",marks:[]}],value:o},n)}):[]}function H(e,t,n={}){return e.map(e=>{let{_key:i,_type:r}=e;if(!i||!r)throw Error("Not a valid block");if(r===t&&"children"in e&&Array.isArray(e.children)&&i){let t=!1,o=e.children.map(e=>{let{_type:i}=e;if("value"in e&&"span"!==i){t=!0;let{value:i,_key:r,_type:o,__inline:a,children:s,...l}=e;return Y({...l,...i,_key:r,_type:o},n)}return e});return t?Y({...e,children:o,_key:i,_type:r},n):e}let o="value"in e&&e.value;return Y({_key:i,_type:r,..."object"==typeof o?o:{}},n)})}function Q(e,t){return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&d.Hg.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&d.EY.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!e[0].children[0].marks?.join("")&&""===e[0].children[0].text}function F({editor:e}){return e.selection?Array.from(d.KE.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>!d.KE.isEditor(e)})).at(0)??[void 0,void 0]:[void 0,void 0]}function Z({editor:e}){let t=d.KE.start(e,[]).path.at(0);return void 0!==t?d.KE.node(e,[t])??[void 0,void 0]:[void 0,void 0]}function X({editor:e}){let t=d.KE.end(e,[]).path.at(0);return void 0!==t?d.KE.node(e,[t])??[void 0,void 0]:[void 0,void 0]}function ee({editor:e,schema:t,node:n}){if(d.KE.isEditor(n))return;if(en({editor:e,schema:t},n))return et({schema:t,element:n});let i=Array.from(d.KE.nodes(e,{mode:"highest",at:[],match:i=>en({editor:e,schema:t},i)&&i.children.some(e=>e._key===n._key)})).at(0)?.at(0);return d.Hg.isElement(i)?et({schema:t,element:i}):void 0}function et({schema:e,element:t}){return H([t],e.block.name)?.at(0)}function en({editor:e,schema:t},n){return d.Hg.isElement(n)&&!e.isInline(n)&&(t.block.name===n._type||t.blockObjects.some(e=>e.name===n._type))}let ei=new WeakMap,er=new WeakMap,eo=new WeakMap,ea=new WeakMap,es=(0,o.createContext)({}),el=(0,o.createContext)(null),ec=()=>{let e=(0,o.useContext)(el);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e};function ed(e){return B.S.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}let eh=(0,h.mj)({types:{context:{},events:{},input:{},emitted:{}},actions:{"emit has pending patches":(0,p.e)({type:"has pending patches"}),"emit mutations":(0,p.b)(({context:e,enqueue:t})=>{for(let n of e.pendingMutations)t.emit({type:"mutation",patches:n.patches,snapshot:n.value})}),"clear pending mutations":(0,p.a)({pendingMutations:[]}),"defer patch":(0,p.a)({pendingMutations:({context:e,event:t})=>{if((0,h.DT)(t,"patch"),0===e.pendingMutations.length)return[{actionId:t.actionId,value:t.value,patches:[t.patch]}];let n=e.pendingMutations.at(-1);return n&&n.actionId===t.actionId?e.pendingMutations.slice(0,-1).concat({value:t.value,actionId:n.actionId,patches:[...n.patches,t.patch]}):e.pendingMutations.concat({value:t.value,actionId:t.actionId,patches:[t.patch]})}})},actors:{"type listener":(0,u.SP)(({input:e,sendBack:t})=>{let n=e.slateEditor.apply;return e.slateEditor.apply=e=>{"insert_text"===e.type||"remove_text"===e.type?t({type:"typing"}):t({type:"not typing"}),n(e)},()=>{e.slateEditor.apply=n}})},guards:{"is typing":(0,f.G)({typing:"typing"}),"no pending mutations":({context:e})=>0===e.pendingMutations.length,"slate is normalizing":({context:e})=>d.KE.isNormalizing(e.slateEditor)},delays:{"mutation debounce":0,"type debounce":250}}).createMachine({id:"mutation",context:({input:e})=>({pendingMutations:[],schema:e.schema,slateEditor:e.slateEditor}),type:"parallel",states:{typing:{initial:"idle",invoke:{src:"type listener",input:({context:e})=>({slateEditor:e.slateEditor})},states:{idle:{on:{typing:{target:"typing"}}},typing:{after:{"type debounce":{target:"idle"}},on:{"not typing":{target:"idle"},typing:{target:"typing",reenter:!0}}}}},mutations:{initial:"idle",states:{idle:{on:{patch:{actions:["defer patch","emit has pending patches"],target:"emitting mutations"}}},"emitting mutations":{after:{"mutation debounce":[{guard:(0,f.D)([(0,f.E)("is typing"),"slate is normalizing"]),target:"idle",actions:["emit mutations","clear pending mutations"]},{target:"emitting mutations",reenter:!0}]},on:{patch:{target:"emitting mutations",actions:["defer patch"],reenter:!0}}}}}}});function ep(e,t,n){let i=null,r=!0,o=[t.span.name,...t.inlineObjects.map(e=>e.name)],a=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,s)=>{if(!k(e))return i={patches:[(0,g.wC)([s])],description:`Block must be an object, got ${String(e)}`,action:"Unset invalid item",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-object.description",action:"inputs.portable-text.invalid-value.not-an-object.action",values:{index:s}}},!0;if(!e._key||"string"!=typeof e._key)return i={patches:[(0,g.hZ)({...e,_key:n()},[s])],description:`Block at index ${s} is missing required _key.`,action:"Set the block with a random _key value",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-key.description",action:"inputs.portable-text.invalid-value.missing-key.action",values:{index:s}}},!0;if(!e._type||!a.includes(e._type)){if("block"===e._type){let n=t.block.name;return i={patches:[(0,g.hZ)({...e,_type:n},[{_key:e._key}])],description:`Block with _key '${e._key}' has invalid type name '${e._type}'. According to the schema, the block type name is '${n}'`,action:`Use type '${n}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.incorrect-block-type.description",action:"inputs.portable-text.invalid-value.incorrect-block-type.action",values:{key:e._key,expectedTypeName:n}}},!0}return i=!e._type&&(0,y.L4)({...e,_type:t.block.name})?{patches:[(0,g.hZ)({...e,_type:t.block.name},[{_key:e._key}])],description:`Block with _key '${e._key}' is missing a type name. According to the schema, the block type name is '${t.block.name}'`,action:`Use type '${t.block.name}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-block-type.description",action:"inputs.portable-text.invalid-value.missing-block-type.action",values:{key:e._key,expectedTypeName:t.block.name}}}:e._type?{patches:[(0,g.wC)([{_key:e._key}])],description:`Block with _key '${e._key}' has invalid _type '${e._type}'`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-type.description",action:"inputs.portable-text.invalid-value.disallowed-type.action",values:{key:e._key,typeName:e._type}}}:{patches:[(0,g.wC)([{_key:e._key}])],description:`Block with _key '${e._key}' is missing an _type property`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-type.description",action:"inputs.portable-text.invalid-value.missing-type.action",values:{key:e._key}}},!0}if(e._type===t.block.name){if(e.children&&!Array.isArray(e.children))return i={patches:[(0,g.hZ)({children:[]},[{_key:e._key}])],description:`Text block with _key '${e._key}' has a invalid required property 'children'.`,action:"Reset the children property",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-or-invalid-children.description",action:"inputs.portable-text.invalid-value.missing-or-invalid-children.action",values:{key:e._key}}},!0;if(void 0===e.children||Array.isArray(e.children)&&0===e.children.length){let r={_type:t.span.name,_key:n(),text:"",marks:[]};return i={autoResolve:!0,patches:[(0,g.Wm)([],[{_key:e._key},"children"]),(0,g.Yr)([r],"after",[{_key:e._key},"children",0])],description:`Children for text block with _key '${e._key}' is empty.`,action:"Insert an empty text",item:e,i18n:{description:"inputs.portable-text.invalid-value.empty-children.description",action:"inputs.portable-text.invalid-value.empty-children.action",values:{key:e._key}}},!0}let a=v(m(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[])));if(Array.isArray(e.markDefs)&&e.markDefs.length>0){let t=v(e.markDefs.map(e=>e._key).filter(e=>!a.includes(e)));if(t.length>0)return i={autoResolve:!0,patches:t.map(t=>(0,g.wC)([{_key:e._key},"markDefs",{_key:t}])),description:`Block contains orphaned data (unused mark definitions): ${t.join(", ")}.`,action:"Remove unused mark definition item",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-mark-defs.description",action:"inputs.portable-text.invalid-value.orphaned-mark-defs.action",values:{key:e._key,unusedMarkDefs:t.map(e=>e.toString())}}},!0}let s=a.filter(e=>!t.decorators.map(e=>e.value).includes(e)).filter(t=>void 0===e.markDefs||!e.markDefs.find(e=>e._key===t));if(s.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>s.includes(e)));if(n){let t=s.join(", ");return i={autoResolve:!0,patches:n.map(t=>(0,g.hZ)((t.marks||[]).filter(e=>!s.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:`Block with _key '${e._key}' contains marks (${t}) not supported by the current content model.`,action:"Remove invalid marks",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-marks.description",action:"inputs.portable-text.invalid-value.orphaned-marks.action",values:{key:e._key,orphanedMarks:s.map(e=>e.toString())}}},!0}}e.children.some((r,a)=>{if(!k(r))return i={patches:[(0,g.wC)([{_key:e._key},"children",a])],description:`Child at index '${a}' in block with key '${e._key}' is not an object.`,action:"Remove the item",item:e,i18n:{description:"inputs.portable-text.invalid-value.non-object-child.description",action:"inputs.portable-text.invalid-value.non-object-child.action",values:{key:e._key,index:a}}},!0;if(!r._key||"string"!=typeof r._key){let t={...r,_key:n()};return i={autoResolve:!0,patches:[(0,g.hZ)(t,[{_key:e._key},"children",a])],description:`Child at index ${a} is missing required _key in block with _key ${e._key}.`,action:"Set a new random _key on the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-key.description",action:"inputs.portable-text.invalid-value.missing-child-key.action",values:{key:e._key,index:a}}},!0}return r._type?o.includes(r._type)?r._type===t.span.name&&"string"!=typeof r.text&&(i={patches:[(0,g.hZ)({...r,text:""},[{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' has missing or invalid text property!`,action:"Write an empty text property to the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.invalid-span-text.description",action:"inputs.portable-text.invalid-value.invalid-span-text.action",values:{key:e._key,childKey:r._key}}},!0):(i={patches:[(0,g.wC)([{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' has invalid '_type' property (${r._type}).`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-child-type.description",action:"inputs.portable-text.invalid-value.disallowed-child-type.action",values:{key:e._key,childKey:r._key,childType:r._type}}},!0):(i={patches:[(0,g.wC)([{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' is missing '_type' property.`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-type.description",action:"inputs.portable-text.invalid-value.missing-child-type.action",values:{key:e._key,childKey:r._key}}},!0)})&&(r=!1)}return!1})&&(r=!1),{valid:r,resolution:i,value:e}):{valid:!1,resolution:{patches:[(0,g.wC)([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-array.description",action:"inputs.portable-text.invalid-value.not-an-array.action"}},value:e}}function eu(e,t){let n=ef(e)||!1;ei.set(e,!0),t(),ei.set(e,n)}function ef(e){return ei.get(e)}let eg=new WeakMap;function ey(e,t){var n;let i=(n=e,eg.get(n));eg.set(e,!1),t(),eg.set(e,i)}function em(e){let[t,n]=e;return[t,n]}function ek(e,t){let n=e,i=t,r=n.length,o=i.length;if(0===r||0===o)return 0;r>o?n=n.substring(r-o):r<o&&(i=i.substring(0,r));let a=Math.min(r,o);if(n===i)return a;let s=0,l=1;for(let e=0;-1!==e;){let t=n.substring(a-l);if(-1===(e=i.indexOf(t)))break;l+=e,(0===e||n.substring(a-l)===i.substring(0,l))&&(s=l,l++)}return s}function ev(e,t){if(!e||!t||e[0]!==t[0])return 0;let n=0,i=Math.min(e.length,t.length),r=i,o=0;for(;n<r;)e.substring(o,r)===t.substring(o,r)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r}function eb(e,t){if(!e||!t||e[e.length-1]!==t[t.length-1])return 0;let n=0,i=Math.min(e.length,t.length),r=i,o=0;for(;n<r;)e.substring(e.length-r,e.length-o)===t.substring(t.length-r,t.length-o)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r}function ex(e,t,n,i,r){let o=e.substring(0,n),a=t.substring(0,i),s=e.substring(n),l=t.substring(i),c=eP(o,a,{checkLines:!1,deadline:r}),d=eP(s,l,{checkLines:!1,deadline:r});return c.concat(d)}function e_(e,t,n){let i=e.slice(n,n+Math.floor(e.length/4)),r=-1,o="",a,s,l,c;for(;-1!==(r=t.indexOf(i,r+1));){let i=ev(e.slice(n),t.slice(r)),d=eb(e.slice(0,n),t.slice(0,r));o.length<d+i&&(o=t.slice(r-d,r)+t.slice(r,r+i),a=e.slice(0,n-d),s=e.slice(n+i),l=t.slice(0,r-d),c=t.slice(r+i))}return 2*o.length>=e.length?[a||"",s||"",l||"",c||"",o||""]:null}var eE=Object.defineProperty,ew=Object.getOwnPropertySymbols,eB=Object.prototype.hasOwnProperty,eT=Object.prototype.propertyIsEnumerable,eS=(e,t,n)=>t in e?eE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eA=(e,t)=>{for(var n in t||(t={}))eB.call(t,n)&&eS(e,n,t[n]);if(ew)for(var n of ew(t))eT.call(t,n)&&eS(e,n,t[n]);return e};function eN(e,t,n){var i,r;let o;if(null===e||null===t)throw Error("Null input. (diff)");let a=eP(e,t,eA({checkLines:!0,deadline:(r=(i=n||{}).timeout||1,o=1,"u">typeof r&&(o=r<=0?Number.MAX_VALUE:r),Date.now()+1e3*o)},i));return function(e){for(let t=0;t<e.length;t++){let[n,i]=e[t];if(0===i.length)continue;let r=i[0];(function(e){let t=e.charCodeAt(0);return t>=55296&&t<=56319})(i[i.length-1])&&0===n&&eC(e,t,1),function(e){let t=e.charCodeAt(0);return t>=56320&&t<=57343}(r)&&0===n&&eC(e,t,-1)}for(let t=0;t<e.length;t++)0===e[t][1].length&&e.splice(t,1)}(a),a}function eP(e,t,n){let i=e,r=t;if(i===r)return i?[[0,i]]:[];let o=ev(i,r),a=i.substring(0,o);o=eb(i=i.substring(o),r=r.substring(o));let s=i.substring(i.length-o),l=function(e,t,n){let i;if(!e)return[[1,t]];if(!t)return[[-1,e]];let r=e.length>t.length?e:t,o=e.length>t.length?t:e,a=r.indexOf(o);if(-1!==a)return i=[[1,r.substring(0,a)],[0,o],[1,r.substring(a+o.length)]],e.length>t.length&&(i[0][0]=-1,i[2][0]=-1),i;if(1===o.length)return[[-1,e],[1,t]];let s=function(e,t,n=1){let i,r,o,a,s;if(n<=0)return null;let l=e.length>t.length?e:t,c=e.length>t.length?t:e;if(l.length<4||2*c.length<l.length)return null;let d=e_(l,c,Math.ceil(l.length/4)),h=e_(l,c,Math.ceil(l.length/2));if(d&&h)i=d[4].length>h[4].length?d:h;else{if(!d&&!h)return null;h?d||(i=h):i=d}if(!i)throw Error("Unable to find a half match.");return e.length>t.length?(r=i[0],o=i[1],a=i[2],s=i[3]):(a=i[0],s=i[1],r=i[2],o=i[3]),[r,o,a,s,i[4]]}(e,t);if(s){let e=s[0],t=s[1],i=s[2],r=s[3],o=s[4],a=eP(e,i,n),l=eP(t,r,n);return a.concat([[0,o]],l)}return n.checkLines&&e.length>100&&t.length>100?function(e,t,n){let i=e,r=t,o=function(e,t){let n=[],i={};function r(e){let t="",r=0,a=-1,s=n.length;for(;a<e.length-1;){-1===(a=e.indexOf(`
`,r))&&(a=e.length-1);let l=e.slice(r,a+1);(i.hasOwnProperty?i.hasOwnProperty(l):void 0!==i[l])?t+=String.fromCharCode(i[l]):(s===o&&(l=e.slice(r),a=e.length),t+=String.fromCharCode(s),i[l]=s,n[s++]=l),r=a+1}return t}n[0]="";let o=4e4,a=r(e);return o=65535,{chars1:a,chars2:r(t),lineArray:n}}(i,r);i=o.chars1,r=o.chars2;let a=o.lineArray,s=eP(i,r,{checkLines:!1,deadline:n.deadline});(function(e,t){for(let n=0;n<e.length;n++){let i=e[n][1],r=[];for(let e=0;e<i.length;e++)r[e]=t[i.charCodeAt(e)];e[n][1]=r.join("")}})(s,a),(s=function(e){let t=e.map(e=>em(e)),n=!1,i=[],r=0,o=null,a=0,s=0,l=0,c=0,d=0;for(;a<t.length;)0===t[a][0]?(i[r++]=a,s=c,l=d,c=0,d=0,o=t[a][1]):(1===t[a][0]?c+=t[a][1].length:d+=t[a][1].length,o&&o.length<=Math.max(s,l)&&o.length<=Math.max(c,d)&&(t.splice(i[r-1],0,[-1,o]),t[i[r-1]+1][0]=1,r--,a=--r>0?i[r-1]:-1,s=0,l=0,c=0,d=0,o=null,n=!0)),a++;for(n&&(t=eI(t)),t=eG(t),a=1;a<t.length;){if(-1===t[a-1][0]&&1===t[a][0]){let e=t[a-1][1],n=t[a][1],i=ek(e,n),r=ek(n,e);i>=r?(i>=e.length/2||i>=n.length/2)&&(t.splice(a,0,[0,n.substring(0,i)]),t[a-1][1]=e.substring(0,e.length-i),t[a+1][1]=n.substring(i),a++):(r>=e.length/2||r>=n.length/2)&&(t.splice(a,0,[0,e.substring(0,r)]),t[a-1][0]=1,t[a-1][1]=n.substring(0,n.length-r),t[a+1][0]=-1,t[a+1][1]=e.substring(r),a++),a++}a++}return t}(s)).push([0,""]);let l=0,c=0,d=0,h="",p="";for(;l<s.length;){switch(s[l][0]){case 1:d++,p+=s[l][1];break;case -1:c++,h+=s[l][1];break;case 0:if(c>=1&&d>=1){s.splice(l-c-d,c+d),l=l-c-d;let e=eP(h,p,{checkLines:!1,deadline:n.deadline});for(let t=e.length-1;t>=0;t--)s.splice(l,0,e[t]);l+=e.length}d=0,c=0,h="",p="";break;default:throw Error("Unknown diff operation.")}l++}return s.pop(),s}(e,t,n):function(e,t,n){let i=e.length,r=t.length,o=Math.ceil((i+r)/2),a=2*o,s=Array(a),l=Array(a);for(let e=0;e<a;e++)s[e]=-1,l[e]=-1;s[o+1]=0,l[o+1]=0;let c=i-r,d=c%2!=0,h=0,p=0,u=0,f=0;for(let g=0;g<o&&!(Date.now()>n);g++){for(let u=-g+h;u<=g-p;u+=2){let f;let y=o+u,m=(f=u===-g||u!==g&&s[y-1]<s[y+1]?s[y+1]:s[y-1]+1)-u;for(;f<i&&m<r&&e.charAt(f)===t.charAt(m);)f++,m++;if(s[y]=f,f>i)p+=2;else if(m>r)h+=2;else if(d){let r=o+c-u;if(r>=0&&r<a&&-1!==l[r]&&f>=i-l[r])return ex(e,t,f,m,n)}}for(let h=-g+u;h<=g-f;h+=2){let p;let y=o+h,m=(p=h===-g||h!==g&&l[y-1]<l[y+1]?l[y+1]:l[y-1]+1)-h;for(;p<i&&m<r&&e.charAt(i-p-1)===t.charAt(r-m-1);)p++,m++;if(l[y]=p,p>i)f+=2;else if(m>r)u+=2;else if(!d){let r=o+c-h;if(r>=0&&r<a&&-1!==s[r]){let a=s[r],l=o+a-r;if(a>=(p=i-p))return ex(e,t,a,l,n)}}}}return[[-1,e],[1,t]]}(e,t,n.deadline)}(i=i.substring(0,i.length-o),r=r.substring(0,r.length-o),n);return a&&l.unshift([0,a]),s&&l.push([0,s]),l=eI(l)}function eK(e,t,n){return 1===n?e+t:t+e}function eO(e,t){return 1===t?[e.substring(0,e.length-1),e[e.length-1]]:[e.substring(1),e[0]]}function eC(e,t,n){var i,r;let o=1===n?-1:1,a=null,s=null,l=t+n;for(;l>=0&&l<e.length&&(null===a||null===s);l+=n){let[i,r]=e[l];if(0!==r.length){if(1===i){null===a&&(a=l);continue}if(-1===i){null===s&&(s=l);continue}if(0===i){if(null===a&&null===s){let[i,r]=eO(e[t][1],n);e[t][1]=i,e[l][1]=eK(e[l][1],r,o);return}break}}}if(null!==a&&null!==s&&(i=a,r=s,1===n?e[i][1][e[i][1].length-1]===e[r][1][e[r][1].length-1]:e[i][1][0]===e[r][1][0])){let[i,r]=eO(e[a][1],o),[l]=eO(e[s][1],o);e[a][1]=i,e[s][1]=l,e[t][1]=eK(e[t][1],r,n);return}let[c,d]=eO(e[t][1],n);e[t][1]=c,null===a?(e.splice(l,0,[1,d]),null!==s&&s>=l&&s++):e[a][1]=eK(e[a][1],d,o),null===s?e.splice(l,0,[-1,d]):e[s][1]=eK(e[s][1],d,o)}let ez=/[^a-zA-Z0-9]/,eD=/\s/,e$=/[\r\n]/,ej=/\n\r?\n$/,eM=/^\r?\n\r?\n/;function eG(e){let t=e.map(e=>em(e));function n(e,t){if(!e||!t)return 6;let n=e.charAt(e.length-1),i=t.charAt(0),r=n.match(ez),o=i.match(ez),a=r&&n.match(eD),s=o&&i.match(eD),l=a&&n.match(e$),c=s&&i.match(e$),d=l&&e.match(ej),h=c&&t.match(eM);return d||h?5:l||c?4:r&&!a&&s?3:a||s?2:r||o?1:0}let i=1;for(;i<t.length-1;){if(0===t[i-1][0]&&0===t[i+1][0]){let e=t[i-1][1],r=t[i][1],o=t[i+1][1],a=eb(e,r);if(a){let t=r.substring(r.length-a);e=e.substring(0,e.length-a),r=t+r.substring(0,r.length-a),o=t+o}let s=e,l=r,c=o,d=n(e,r)+n(r,o);for(;r.charAt(0)===o.charAt(0);){e+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);let t=n(e,r)+n(r,o);t>=d&&(d=t,s=e,l=r,c=o)}t[i-1][1]!==s&&(s?t[i-1][1]=s:(t.splice(i-1,1),i--),t[i][1]=l,c?t[i+1][1]=c:(t.splice(i+1,1),i--))}i++}return t}function eI(e){let t=e.map(e=>em(e));t.push([0,""]);let n=0,i=0,r=0,o="",a="",s;for(;n<t.length;)switch(t[n][0]){case 1:r++,a+=t[n][1],n++;break;case -1:i++,o+=t[n][1],n++;break;case 0:i+r>1?(0!==i&&0!==r&&(0!==(s=ev(a,o))&&(n-i-r>0&&0===t[n-i-r-1][0]?t[n-i-r-1][1]+=a.substring(0,s):(t.splice(0,0,[0,a.substring(0,s)]),n++),a=a.substring(s),o=o.substring(s)),0!==(s=eb(a,o))&&(t[n][1]=a.substring(a.length-s)+t[n][1],a=a.substring(0,a.length-s),o=o.substring(0,o.length-s))),n-=i+r,t.splice(n,i+r),o.length&&(t.splice(n,0,[-1,o]),n++),a.length&&(t.splice(n,0,[1,a]),n++),n++):0!==n&&0===t[n-1][0]?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,r=0,i=0,o="",a="";break;default:throw Error("Unknown diff operation")}""===t[t.length-1][1]&&t.pop();let l=!1;for(n=1;n<t.length-1;)0===t[n-1][0]&&0===t[n+1][0]&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)===t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),l=!0):t[n][1].substring(0,t[n+1][1].length)===t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),l=!0)),n++;return l&&(t=eI(t)),t}var eL=Object.defineProperty,eR=Object.getOwnPropertySymbols,eU=Object.prototype.hasOwnProperty,eV=Object.prototype.propertyIsEnumerable,eJ=(e,t,n)=>t in e?eL(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eW=(e,t)=>{for(var n in t||(t={}))eU.call(t,n)&&eJ(e,n,t[n]);if(eR)for(var n of eR(t))eV.call(t,n)&&eJ(e,n,t[n]);return e};let eY={threshold:.5,distance:1e3};function eq(e,t,n,i={}){if(null===e||null===t||null===n)throw Error("Null input. (match())");let r=Math.max(0,Math.min(n,e.length));return e===t?0:e.length?e.substring(r,r+t.length)===t?r:function(e,t,n,i={}){if(t.length>32)throw Error("Pattern too long for this browser.");let r=eW(eW({},eY),i),o=function(e){let t={};for(let n=0;n<e.length;n++)t[e.charAt(n)]=0;for(let n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t}(t);function a(e,i){let o=e/t.length,a=Math.abs(n-i);return r.distance?o+a/r.distance:a?1:o}let s=r.threshold,l=e.indexOf(t,n);-1!==l&&(s=Math.min(a(0,l),s),-1!==(l=e.lastIndexOf(t,n+t.length))&&(s=Math.min(a(0,l),s)));let c=1<<t.length-1;l=-1;let d,h,p=t.length+e.length,u=[];for(let i=0;i<t.length;i++){for(d=0,h=p;d<h;)a(i,n+h)<=s?d=h:p=h,h=Math.floor((p-d)/2+d);p=h;let r=Math.max(1,n-h+1),f=Math.min(n+h,e.length)+t.length,g=Array(f+2);g[f+1]=(1<<i)-1;for(let t=f;t>=r;t--){let d=o[e.charAt(t-1)];if(0===i?g[t]=(g[t+1]<<1|1)&d:g[t]=(g[t+1]<<1|1)&d|((u[t+1]|u[t])<<1|1)|u[t+1],g[t]&c){let e=a(i,t-1);if(e<=s){if(s=e,(l=t-1)>n)r=Math.max(1,2*n-l);else break}}}if(a(i+1,n)>s)break;u=g}return l}(e,t,r,i):-1}function eH(e){let t=[];for(let n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function eQ(e){let t=[];for(let n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function eF(e,t){let n=0,i=0,r=0,o=0,a;for(a=0;a<e.length&&(1!==e[a][0]&&(n+=e[a][1].length),-1!==e[a][0]&&(i+=e[a][1].length),!(n>t));a++)r=n,o=i;return e.length!==a&&-1===e[a][0]?o:o+(t-r)}function eZ(e){let t=0;for(let n=0;n<e.length;n++){let i=e.codePointAt(n);if(typeof i>"u")throw Error("Failed to get codepoint");t+=eX(i)}return t}function eX(e){return e<=127?1:e<=2047?2:e<=65535?3:4}function e0(e,t){return{diffs:[],start1:e,start2:t,utf8Start1:e,utf8Start2:t,length1:0,length2:0,utf8Length1:0,utf8Length2:0}}let e1=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;function e2(e){if(!e)return[];let t=[],n=e.split(`
`),i=0;for(;i<n.length;){let e=n[i].match(e1);if(!e)throw Error(`Invalid patch string: ${n[i]}`);let r=e0(e8(e[1]),e8(e[3]));for(t.push(r),""===e[2]?(r.start1--,r.utf8Start1--,r.length1=1,r.utf8Length1=1):"0"===e[2]?(r.length1=0,r.utf8Length1=0):(r.start1--,r.utf8Start1--,r.utf8Length1=e8(e[2]),r.length1=r.utf8Length1),""===e[4]?(r.start2--,r.utf8Start2--,r.length2=1,r.utf8Length2=1):"0"===e[4]?(r.length2=0,r.utf8Length2=0):(r.start2--,r.utf8Start2--,r.utf8Length2=e8(e[4]),r.length2=r.utf8Length2),i++;i<n.length;){let e;let t=n[i],o=t.charAt(0);if("@"===o)break;if(""===o){i++;continue}try{e=decodeURI(t.slice(1))}catch{throw Error(`Illegal escape in parse: ${t}`)}let a=eZ(e)-e.length;if("-"===o)r.diffs.push([-1,e]),r.length1-=a;else if("+"===o)r.diffs.push([1,e]),r.length2-=a;else if(" "===o)r.diffs.push([0,e]),r.length1-=a,r.length2-=a;else throw Error(`Invalid patch mode "${o}" in: ${e}`);i++}}return t}function e8(e){return parseInt(e,10)}let e3=new WeakMap,e4=new WeakMap;function e6(e){return e3.get(e)??!1}function e5(e){return e4.get(e)??!1}let e9=()=>(function(e){let t=e7();return(function(e=16){let t=new Uint8Array(e);return(0,b.A)(t),t})(12).reduce((e,n)=>e+t[n],"").slice(0,e)})(12),e7=(()=>{let e;return()=>{if(e)return e;e=[];for(let t=0;t<256;++t)e[t]=(t+256).toString(16).slice(1);return e}})(),te=new WeakMap;function tt(e,t){te.set(e,e9()),d.KE.withoutNormalizing(e,t),te.set(e,void 0)}function tn(e){return void 0!==te.get(e)}let ti=new WeakMap;function tr(e){return ti.get(e)?.actionSetId}let to=I("plugin:withUndoRedo"),ta=new WeakMap,ts=new WeakMap,tl=e=>{let t=ta.get(e);return void 0===t||t},tc=e=>(ts.get(e)||ts.set(e,[]),ts.get(e)||[]);function td(e,t,n,i,r){let o={...n};if("insert"===t.type&&1===t.path.length){let e=(i||[]).findIndex(e=>c({_key:e._key},t.path[0]));return to(`Adjusting block path (+${t.items.length}) for '${o.type}' operation and patch '${t.type}'`),[th(o,t.items.length,e)]}if("unset"===t.type&&1===t.path.length){let e=(r||[]).findIndex(e=>c({_key:e._key},t.path[0]));return"path"in o&&Array.isArray(o.path)&&o.path[0]===e?(to("Skipping transformation that targeted removed block"),[]):[th(o,-1,e)]}if("unset"===t.type&&0===t.path.length)return to(`Adjusting selection for unset everything patch and ${n.type} operation`),[];if("diffMatchPatch"===t.type){var a,s;let n;let i=(a=e,"set_selection"===(s=o).type&&a.selection?n=a.children[a.selection.focus.path[0]]:"path"in s&&(n=a.children[s.path[0]]),n);return i&&c({_key:i._key},t.path[0])&&e2(t.value).forEach(e=>{let t=0,n=e.utf8Start1,{diffs:i}=e;if(i.forEach((e,r)=>{let[o,a]=e;1===o?(t+=a.length,n+=a.length):-1===o?(t-=a.length,n-=a.length):0===o&&(i.slice(r).every(([e])=>0===e)||(n+=a.length))}),"insert_text"===o.type&&n<o.offset&&(o.offset+=t),"remove_text"===o.type&&n<=o.offset-o.text.length&&(o.offset+=t),"set_selection"===o.type){let e=o.properties?.focus?{...o.properties.focus}:void 0,i=o?.properties?.anchor?{...o.properties.anchor}:void 0,r=o?.newProperties?.focus?{...o.newProperties.focus}:void 0,a=o?.newProperties?.anchor?{...o.newProperties.anchor}:void 0;(e&&i||r&&a)&&([e,i,r,a].forEach(e=>{e&&n<e.offset&&(e.offset+=t)}),e&&i&&(o.properties={focus:e,anchor:i}),r&&a&&(o.newProperties={focus:r,anchor:a}))}}),[o]}return[o]}function th(e,t,n){let i={...e};if(n>=0&&"set_selection"!==i.type&&Array.isArray(i.path)&&i.path[0]>=n+t&&i.path[0]+t>-1){let e=[i.path[0]+t,...i.path.slice(1)];i.path=e}if("set_selection"===i.type){let e=i.properties?.focus?{...i.properties.focus}:void 0,r=i?.properties?.anchor?{...i.properties.anchor}:void 0,o=i?.newProperties?.focus?{...i.newProperties.focus}:void 0,a=i?.newProperties?.anchor?{...i.newProperties.anchor}:void 0;(e&&r||o&&a)&&([e,r,o,a].forEach(e=>{e&&e.path[0]>=n+t&&e.path[0]+t>-1&&(e.path=[e.path[0]+t,...e.path.slice(1)])}),e&&r&&(i.properties={focus:e,anchor:r}),o&&a&&(i.newProperties={focus:o,anchor:a}))}return i}let tp=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&d.wA.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&d.wA.equals(e.path,t.path)),tu=(e,t)=>!!(t&&"set_selection"===e.type&&"set_selection"===t.type),tf=e=>"set_selection"!==e.type;function tg(e,t){let n=tl(e);ta.set(e,!1),t(),ta.set(e,n)}let ty=I("sync machine"),tm=(0,u.SP)(({sendBack:e,input:t})=>{tv({context:t.context,sendBack:e,slateEditor:t.slateEditor,value:t.value,streamBlocks:t.streamBlocks})}),tk=(0,h.mj)({types:{context:{},input:{},events:{},emitted:{}},actions:{"assign initial value synced":(0,p.a)({initialValueSynced:!0}),"assign readOnly":(0,p.a)({readOnly:({event:e})=>((0,h.DT)(e,"update readOnly"),e.readOnly)}),"assign pending value":(0,p.a)({pendingValue:({event:e})=>((0,h.DT)(e,"update value"),e.value)}),"clear pending value":(0,p.a)({pendingValue:void 0}),"assign previous value":(0,p.a)({previousValue:({event:e})=>((0,h.DT)(e,"done syncing"),e.value)}),"emit done syncing initial value":(0,p.e)({type:"done syncing initial value"})},guards:{"initial value synced":({context:e})=>e.initialValueSynced,"is busy":({context:e})=>{let t=!e.readOnly,n=e.isProcessingLocalChanges,i=ef(e.slateEditor)??!1,r=t&&(n||i);return ty("isBusy",{isBusy:r,editable:t,isProcessingLocalChanges:n,isChanging:i}),r},"value changed while syncing":({context:e,event:t})=>((0,h.DT)(t,"done syncing"),e.pendingValue!==t.value),"pending value equals previous value":({context:e})=>c(e.pendingValue,e.previousValue)},actors:{"sync value":tm}}).createMachine({id:"sync",context:({input:e})=>({initialValueSynced:!1,isProcessingLocalChanges:!1,keyGenerator:e.keyGenerator,schema:e.schema,readOnly:e.readOnly,slateEditor:e.slateEditor,pendingValue:void 0,previousValue:void 0}),on:{"has pending patches":{actions:(0,p.a)({isProcessingLocalChanges:!0})},mutation:{actions:(0,p.a)({isProcessingLocalChanges:!1})},"update readOnly":{actions:["assign readOnly"]}},type:"parallel",states:{"setting up":{initial:"syncing initial value",states:{"syncing initial value":{entry:[()=>{ty("entry: syncing initial value")}],exit:[()=>{ty("exit: syncing initial value")}],always:{guard:"initial value synced",target:"done syncing initial value"}},"done syncing initial value":{entry:["emit done syncing initial value",()=>{ty("entry: done syncing initial value")}],exit:[()=>{ty("exit: done syncing initial value")}],type:"final"}}},syncing:{initial:"idle",states:{idle:{entry:[()=>{ty("entry: syncing->idle")}],exit:[()=>{ty("exit: syncing->idle")}],on:{"update value":[{guard:"is busy",target:"busy",actions:["assign pending value"]},{target:"syncing",actions:["assign pending value"]}]}},busy:{entry:[()=>{ty("entry: syncing->busy")}],exit:[()=>{ty("exit: syncing->busy")}],after:{1e3:[{guard:"is busy",target:".",reenter:!0,actions:[()=>{ty("reenter: syncing->busy")}]},{target:"syncing"}]},on:{"update value":[{actions:["assign pending value"]}]}},syncing:{entry:[()=>{ty("entry: syncing->syncing")}],exit:[()=>{ty("exit: syncing->syncing")}],always:{guard:"pending value equals previous value",target:"idle",actions:["clear pending value","assign initial value synced"]},invoke:{src:"sync value",id:"sync value",input:({context:e})=>({context:{keyGenerator:e.keyGenerator,previousValue:e.previousValue,readOnly:e.readOnly,schema:e.schema},slateEditor:e.slateEditor,streamBlocks:!e.initialValueSynced,value:e.pendingValue})},on:{"update value":{actions:["assign pending value"]},patch:{actions:[(0,p.e)(({event:e})=>e)]},"invalid value":{actions:[(0,p.e)(({event:e})=>e)]},"value changed":{actions:[(0,p.e)(({event:e})=>e)]},"done syncing":[{guard:"value changed while syncing",actions:["assign previous value","assign initial value synced"],target:"syncing",reenter:!0},{target:"idle",actions:["clear pending value","assign previous value","assign initial value synced"]}]}}}}}});async function tv({context:e,sendBack:t,slateEditor:n,streamBlocks:i,value:r}){let o=!1,a=!0,s=!!n.selection;if(r&&0!==r.length||(ty("Value is empty"),d.KE.withoutNormalizing(n,()=>{tg(n,()=>{ey(n,()=>{s&&d.gB.deselect(n);let e=n.children.length;n.children.forEach((t,i)=>{d.gB.removeNodes(n,{at:[e-1-i]})}),d.gB.insertNodes(n,n.pteCreateTextBlock({decorators:[]}),{at:[0]}),s&&d.gB.select(n,[0,0])})})}),o=!0),r&&r.length>0){let s=q(r,{schemaTypes:e.schema});await new Promise(l=>{d.KE.withoutNormalizing(n,()=>{eu(n,()=>{ey(n,async()=>{let h=n.children.length;if(s.length<h){for(let e=h-1;e>s.length-1;e--)d.gB.removeNodes(n,{at:[e]});o=!0}for await(let[l,h]of tb({slateValue:s,streamBlocks:i})){let{blockChanged:i,blockValid:s}=function({context:e,sendBack:t,block:n,index:i,slateEditor:r,value:o}){let a=!1,s=!0,l=r.children[i],h=l&&!c(n,l);return d.KE.withoutNormalizing(r,()=>{eu(r,()=>{ey(r,()=>{if(h&&s){let h=[o[i]],p=ep(h,e.schema,e.keyGenerator);!p.valid&&p.resolution?.autoResolve&&p.resolution?.patches.length>0&&!e.readOnly&&e.previousValue&&e.previousValue!==o&&(console.warn(`${p.resolution.action} for block with _key '${h[0]._key}'. ${p.resolution?.description}`),p.resolution.patches.forEach(e=>{t({type:"patch",patch:e})})),p.valid||p.resolution?.autoResolve?(l._key===n._key?(ty.enabled&&ty("Updating block",l,n),function(e,t,n,i){if(d.gB.setNodes(e,t,{at:[i]}),e.isTextBlock(t)&&e.isTextBlock(n)){let r=n.children.length;t.children.length<r&&Array.from(Array(r-t.children.length)).forEach((t,n)=>{let o=r-1-n;o>0&&(ty("Removing child"),d.gB.removeNodes(e,{at:[i,o]}))}),t.children.forEach((t,r)=>{let o=n.children[r],a=!c(t,o),s=!c(t.text,o?.text),l=[i,r];if(a){if(t._key===o?._key){ty("Updating changed child",t,o),d.gB.setNodes(e,t,{at:l});let n=d.EY.isText(t)&&"span"===t._type&&d.EY.isText(o)&&"span"===o._type;n&&s?(d.gB.delete(e,{at:{focus:{path:l,offset:0},anchor:{path:l,offset:o.text.length}}}),d.gB.insertText(e,t.text,{at:l}),e.onChange()):n||(ty("Updating changed inline object child",t),d.gB.setNodes(e,{_key:W},{at:[...l,0],voids:!0}))}else o?(ty("Replacing child",t),d.gB.removeNodes(e,{at:[i,r]}),d.gB.insertNodes(e,t,{at:[i,r]}),e.onChange()):o||(ty("Inserting new child",t),d.gB.insertNodes(e,t,{at:[i,r]}),e.onChange())}})}}(r,n,l,i)):(ty.enabled&&ty("Replacing block",l,n),function(e,t,n){let i=e.selection,r=i&&i.focus.path[0]===n;r&&d.gB.deselect(e),d.gB.removeNodes(e,{at:[n]}),d.gB.insertNodes(e,t,{at:[n]}),e.onChange(),r&&d.gB.select(e,i)}(r,n,i)),a=!0):(t({type:"invalid value",resolution:p.resolution,value:o}),s=!1)}if(!l&&s){let a=ep([o[i]],e.schema,e.keyGenerator);ty.enabled&&ty("Validating and inserting new block in the end of the value",n),a.valid||a.resolution?.autoResolve?d.gB.insertNodes(r,n,{at:[i]}):(ty("Invalid",a),t({type:"invalid value",resolution:a.resolution,value:o}),s=!1)}})})}),{blockChanged:a,blockValid:s}}({context:e,sendBack:t,block:l,index:h,slateEditor:n,value:r});o=i||o,a=a&&s}l()})})})})}if(!a){ty("Invalid value, returning"),t({type:"done syncing",value:r});return}if(o){ty("Server value changed, syncing editor");try{n.onChange()}catch(e){console.error(e),t({type:"invalid value",resolution:null,value:r}),t({type:"done syncing",value:r});return}s&&!n.selection&&(d.gB.select(n,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),n.onChange()),t({type:"value changed",value:r})}else ty("Server value and editor value is equal, no need to sync.");t({type:"done syncing",value:r})}async function*tb({slateValue:e,streamBlocks:t}){let n=0;for await(let i of e)t&&n%10==0&&await new Promise(e=>setTimeout(e,0)),yield[i,n],n++}let tx=I("component:PortableTextEditor:Synchronizer");function t_(e){let t,n,i,a,l,c,d,h,p,u,f,g,y,m,k,v;let b=(0,r.c)(41),{editorActor:x,slateEditor:_}=e,E=(0,s.d4)(e.editorActor,tw),w=(0,s.d4)(e.editorActor,tE);b[0]!==e.editorActor?(t=e.editorActor.getSnapshot(),b[0]=e.editorActor,b[1]=t):t=b[1];let B=t.context.keyGenerator;b[2]!==e.editorActor?(n=e.editorActor.getSnapshot().matches({"edit mode":"read only"}),b[2]=e.editorActor,b[3]=n):n=b[3],b[4]!==e.editorActor?(i=e.editorActor.getSnapshot(),b[4]=e.editorActor,b[5]=i):i=b[5],b[6]!==_||b[7]!==t.context.keyGenerator||b[8]!==n||b[9]!==i.context.schema?(a={input:{keyGenerator:B,readOnly:n,schema:i.context.schema,slateEditor:_}},b[6]=_,b[7]=t.context.keyGenerator,b[8]=n,b[9]=i.context.schema,b[10]=a):a=b[10];let T=(0,s.qf)(tk,a);b[11]!==x?(l=x.getSnapshot(),b[11]=x,b[12]=l):l=b[12],b[13]!==_||b[14]!==l.context.schema?(c={input:{schema:l.context.schema,slateEditor:_}},b[13]=_,b[14]=l.context.schema,b[15]=c):c=b[15];let S=(0,s.qf)(eh,c);return b[16]!==x||b[17]!==S||b[18]!==T?(d=()=>{let e=S.on("*",e=>{"has pending patches"===e.type&&T.send({type:"has pending patches"}),"mutation"===e.type&&(T.send({type:"mutation"}),x.send({type:"mutation",patches:e.patches,snapshot:e.snapshot,value:e.snapshot}))});return()=>{e.unsubscribe()}},h=[S,T,x],b[16]=x,b[17]=S,b[18]=T,b[19]=d,b[20]=h):(d=b[19],h=b[20]),(0,o.useEffect)(d,h),b[21]!==e.editorActor||b[22]!==_||b[23]!==T?(u=()=>{let t=T.on("*",t=>{switch(t.type){case"invalid value":e.editorActor.send({...t,type:"notify.invalid value"});break;case"value changed":e.editorActor.send({...t,type:"notify.value changed"});break;case"patch":e.editorActor.send({...t,type:"internal.patch",value:H(_.children,e.editorActor.getSnapshot().context.schema.block.name,eo.get(_))});break;default:e.editorActor.send(t)}});return()=>{t.unsubscribe()}},p=[e.editorActor,_,T],b[21]=e.editorActor,b[22]=_,b[23]=T,b[24]=p,b[25]=u):(p=b[24],u=b[25]),(0,o.useEffect)(u,p),b[26]!==w||b[27]!==T?(f=()=>{T.send({type:"update readOnly",readOnly:w})},g=[T,w],b[26]=w,b[27]=T,b[28]=f,b[29]=g):(f=b[28],g=b[29]),(0,o.useEffect)(f,g),b[30]!==T||b[31]!==E?(y=()=>{tx("Value from props changed, syncing new value"),T.send({type:"update value",value:E})},m=[T,E],b[30]=T,b[31]=E,b[32]=y,b[33]=m):(y=b[32],m=b[33]),(0,o.useEffect)(y,m),b[34]!==x||b[35]!==S?(k=()=>{tx("Subscribing to patch events");let e=x.on("internal.patch",e=>{S.send({...e,type:"patch"})});return()=>{tx("Unsubscribing to patch events"),e.unsubscribe()}},b[34]=x,b[35]=S,b[36]=k):k=b[36],b[37]!==x||b[38]!==S||b[39]!==_?(v=[x,S,_],b[37]=x,b[38]=S,b[39]=_,b[40]=v):v=b[40],(0,o.useEffect)(k,v),null}function tE(e){return e.matches({"edit mode":"read only"})}function tw(e){return e.context.value}t_.displayName="Synchronizer";let tB={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},tT=[{mimeType:"application/json",serialize:({snapshot:e,event:t})=>{let n=e.context.converters.find(e=>"application/x-portable-text"===e.mimeType);return n?{...n.serialize({snapshot:e,event:t}),mimeType:"application/json",originEvent:t.originEvent}:{type:"serialization.failure",mimeType:"application/json",originEvent:t.originEvent,reason:"No application/x-portable-text Converter found"}},deserialize:({snapshot:e,event:t})=>{let n=e.context.converters.find(e=>"application/x-portable-text"===e.mimeType);return n?{...n.deserialize({snapshot:e,event:t}),mimeType:"application/json"}:{type:"deserialization.failure",mimeType:"application/json",reason:"No application/x-portable-text Converter found"}}},{mimeType:"application/x-portable-text",serialize:({snapshot:e,event:t})=>{let n=e.beta.internalDrag?.origin.selection??e.context.selection;if(!n)return{type:"serialization.failure",mimeType:"application/x-portable-text",originEvent:t.originEvent,reason:"No selection"};let i=(0,_.RJ)({blocks:e.context.value,selection:n});return 0===i.length?{type:"serialization.failure",mimeType:"application/x-portable-text",reason:"No blocks serialized",originEvent:t.originEvent}:{type:"serialization.success",data:JSON.stringify(i),mimeType:"application/x-portable-text",originEvent:t.originEvent}},deserialize:({snapshot:e,event:t})=>{let n=JSON.parse(t.data);if(!Array.isArray(n))return{type:"deserialization.failure",mimeType:"application/x-portable-text",reason:"Data is not an array"};let i=n.flatMap(t=>{let n=(0,x.rT)({context:e.context,block:t,options:{refreshKeys:!e.beta.hasTag?.("dragging internally")}});return n?[n]:[]});return 0===i.length&&n.length>0?{type:"deserialization.failure",mimeType:"application/x-portable-text",reason:"No blocks were parsed"}:{type:"deserialization.success",data:i,mimeType:"application/x-portable-text"}}},{mimeType:"text/html",serialize:({snapshot:e,event:t})=>{let n=e.beta.internalDrag?.origin.selection??e.context.selection;if(!n)return{type:"serialization.failure",mimeType:"text/html",originEvent:t.originEvent,reason:"No selection"};let i=(0,_.RJ)({blocks:e.context.value,selection:n}),r=(0,w.FE)(i,{onMissingComponent:!1,components:{unknownType:({children:e})=>void 0!==e?`${e}`:""}});return""===r?{type:"serialization.failure",mimeType:"text/html",originEvent:t.originEvent,reason:"Serialized HTML is empty"}:{type:"serialization.success",data:r,mimeType:"text/html",originEvent:t.originEvent}},deserialize:({snapshot:e,event:t})=>{let n=(0,E.l$)(t.data,e.context.schema.portableText,{keyGenerator:e.context.keyGenerator,unstable_whitespaceOnPasteMode:e.context.schema.block.options.unstable_whitespaceOnPasteMode});return 0===n.length?{type:"deserialization.failure",mimeType:"text/html",reason:"No blocks deserialized"}:{type:"deserialization.success",data:n,mimeType:"text/html"}}},{mimeType:"text/plain",serialize:({snapshot:e,event:t})=>{let n=e.beta.internalDrag?.origin.selection??e.context.selection;return n?{type:"serialization.success",data:(0,_.RJ)({blocks:e.context.value,selection:n}).map(t=>(0,y.L4)(t)?t.children.map(t=>t._type===e.context.schema.span.name?t.text:e.beta.hasTag("dragging internally")?`[${e.context.schema.inlineObjects.find(e=>e.name===t._type)?.title??"Object"}]`:"").join(""):e.beta.hasTag("dragging internally")?`[${e.context.schema.blockObjects.find(e=>e.name===t._type)?.title??"Object"}]`:"").filter(e=>""!==e).join(`

`),mimeType:"text/plain",originEvent:t.originEvent}:{type:"serialization.failure",mimeType:"text/plain",originEvent:t.originEvent,reason:"No selection"}},deserialize:({snapshot:e,event:t})=>{let n=`<html><body>${String(t.data).replace(/[&<>"'`=/]/g,e=>tB[e]).split(/\n{2,}/).map(e=>e?`<p>${e.replace(/(?:\r\n|\r|\n)/g,"<br/>")}</p>`:"<p></p>").join("")}</body></html>`,i=(0,E.l$)(n,e.context.schema.portableText,{keyGenerator:e.context.keyGenerator});return 0===i.length?{type:"deserialization.failure",mimeType:"text/plain",reason:"No blocks deserialized"}:{type:"deserialization.success",data:i,mimeType:"text/plain"}}}],tS=I("operationToPatches"),tA=({action:e})=>{(0,d.bc)(e.editor,`
`)};function tN(e){return"span"===e._type&&"text"in e&&"string"==typeof e.text&&(typeof e.marks>"u"||Array.isArray(e.marks)&&e.marks.every(e=>"string"==typeof e))}function tP({editor:e,blockPath:t,spanPath:n}){let i;for(let[r,o]of d.bP.children(e,t,{reverse:!0}))if(e.isTextSpan(r)&&d.wA.isBefore(o,n)){i=r;break}return i}function tK({editor:e,blockPath:t,spanPath:n}){let i;for(let[r,o]of d.bP.children(e,t))if(e.isTextSpan(r)&&d.wA.isAfter(o,n)){i=r;break}return i}let tO=I("plugin:withPortableTextMarkModel"),tC=I("API:editable"),tz=({context:e,action:t})=>{let n,i,r;let o=t.editor;if(!o.selection||d.Q6.isCollapsed(o.selection))return;let a=[];for(let[n,s]of d.KE.nodes(o,{at:o.selection,match:e=>o.isTextBlock(e),reverse:d.Q6.isBackward(o.selection)})){if(0===n.children.length||1===n.children.length&&""===n.children[0].text)continue;let l=e.keyGenerator(),c=n.markDefs??[];for(let[e,h]of(void 0===c.find(e=>e._type===t.annotation.name&&e._key===l)&&(d.gB.setNodes(o,{markDefs:[...c,{_type:t.annotation.name,_key:l,...t.annotation.value}]},{at:s}),r=[{_key:n._key},"markDefs",{_key:l}],d.Q6.isBackward(o.selection)?a.unshift(r):a.push(r)),d.gB.setNodes(o,{},{match:d.EY.isText,split:!0}),d.bP.children(o,s))){if(!o.isTextSpan(e)||!d.Q6.includes(o.selection,h))continue;let r=e.marks??[],a=r.filter(e=>c.some(n=>n._key===e&&n._type===t.annotation.name));d.gB.setNodes(o,{marks:[...r.filter(e=>!a.includes(e)),l]},{at:h}),i=[{_key:n._key},"children",{_key:e._key}]}}return r&&i&&(n={markDefPath:r,markDefPaths:a,spanPath:i}),n},tD=({action:e})=>{let t=[R(e.at,e.editor)[0]],n=[R(e.to,e.editor)[0]];d.gB.moveNodes(e.editor,{at:t,to:n,mode:"highest"})},t$=I("behaviors:action"),tj={"annotation.add":tz,"annotation.remove":({action:e})=>{let t=e.editor;if(tC("Removing annotation",e.annotation.name),t.selection){if(d.Q6.isCollapsed(t.selection)){let[n,i]=d.KE.node(t,t.selection,{depth:1});if(!t.isTextBlock(n))return;let r=(n.markDefs??[]).filter(t=>t._type===e.annotation.name),[o,a]=d.KE.node(t,t.selection,{depth:2});if(!t.isTextSpan(o))return;let s=o.marks?.find(e=>r.some(t=>t._key===e));if(!s)return;let l=[];for(let[e,n]of d.bP.children(t,i,{reverse:!0}))if(t.isTextSpan(e)&&d.wA.isBefore(n,a)){if(e.marks?.includes(s))l.push([e,n]);else break}let c=[];for(let[e,n]of d.bP.children(t,i))if(t.isTextSpan(e)&&d.wA.isAfter(n,a)){if(e.marks?.includes(s))c.push([e,n]);else break}for(let[e,n]of[...l,[o,a],...c])d.gB.setNodes(t,{marks:e.marks?.filter(e=>e!==s)},{at:n})}else for(let[n,i]of(d.gB.setNodes(t,{},{match:e=>t.isTextSpan(e),split:!0,hanging:!0}),d.KE.nodes(t,{at:t.selection,match:e=>t.isTextBlock(e)})))for(let[r,o]of d.bP.children(t,i)){if(!t.isTextSpan(r)||!d.Q6.includes(t.selection,o))continue;let i=n.markDefs??[],a=r.marks??[],s=a.filter(t=>i.find(e=>e._key===t)?._type!==e.annotation.name);s.length!==a.length&&d.gB.setNodes(t,{marks:s},{at:o})}}},"block.set":({context:e,action:t})=>{let n=V({anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}},t.editor);if(!n)throw Error(`Unable to convert ${JSON.stringify(t.at)} into a Slate Range`);let i=d.KE.node(t.editor,n,{depth:1})?.[0];if(!i)throw Error(`Unable to find block at ${JSON.stringify(t.at)}`);let r=H([i],e.schema.block.name,eo.get(t.editor)).at(0);if(!r)throw Error(`Unable to parse block at ${JSON.stringify(t.at)}`);let{_type:o,...a}=t.props,s=(0,x.rT)({context:e,block:{...r,...a},options:{refreshKeys:!1}});if(!s)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let l=q([s],{schemaTypes:e.schema})?.at(0);if(!l)throw Error("Unable to convert block to Slate value");d.gB.setNodes(t.editor,l,{at:n})},"block.unset":({context:e,action:t})=>{let n=V({anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}},t.editor);if(!n)throw Error(`Unable to convert ${JSON.stringify(t.at)} into a Slate Range`);let i=d.KE.node(t.editor,n,{depth:1})?.[0];if(!i)throw Error(`Unable to find block at ${JSON.stringify(t.at)}`);let r=H([i],e.schema.block.name,eo.get(t.editor)).at(0);if(!r)throw Error(`Unable to parse block at ${JSON.stringify(t.at)}`);if((0,x.zS)(e.schema,r)){let i=t.props.filter(e=>"_type"!==e),o=(0,x.rT)({context:e,block:N(r,i),options:{refreshKeys:!1}});if(!o)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let a={};for(let e of i)e in o?a[e]=o[e]:a[e]=void 0;d.gB.setNodes(t.editor,a,{at:n});return}let o=(0,x.rT)({context:e,block:N(r,t.props.filter(e=>"_type"!==e)),options:{refreshKeys:!1}});if(!o)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let{_type:a,_key:s,...l}=o;d.gB.setNodes(t.editor,{_type:a,_key:s,value:l},{at:n})},blur:({action:e})=>{a.rL.blur(e.editor)},"decorator.add":({context:e,action:t})=>{let n=t.editor,i=t.decorator,r=H(n.children,e.schema.block.name,eo.get(n)),o=t.offsets?.anchor?(0,_.m4)({value:r,blockOffset:t.offsets.anchor,direction:"backward"}):void 0,a=t.offsets?.focus?(0,_.m4)({value:r,blockOffset:t.offsets.focus,direction:"forward"}):void 0,s=o&&a?{anchor:o,focus:a}:void 0,l=s?V(s,t.editor)??n.selection:n.selection;if(!l)return;let c=U(r,l,e.schema),h=c?(0,P.eX)({value:r,selectionPoint:c.anchor}):void 0,p=c?(0,P.eX)({value:r,selectionPoint:c.focus}):void 0;if(!h||!p)throw Error("Unable to find anchor or focus offset");if(d.Q6.isExpanded(l)){d.gB.setNodes(n,{},{at:l,match:d.EY.isText,split:!0,hanging:!0});let t=H(n.children,e.schema.block.name,eo.get(n)),r=(0,P.lv)({value:t,offsets:{anchor:h,focus:p},backward:c?.backward}),o=(0,K.bu)({context:{activeDecorators:[],converters:[],keyGenerator:e.keyGenerator,readOnly:!1,schema:e.schema,selection:r,value:t}});if(!o)throw Error("Unable to find trimmed selection");let a=V(o,n);if(!a)throw Error("Unable to find new selection");for(let[e,t]of d.Q6.isRange(a)?[...d.KE.nodes(n,{at:a,match:e=>d.EY.isText(e)})]:[]){let r=[...(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==i),i];d.gB.setNodes(n,{marks:r},{at:t,match:d.EY.isText,split:!0,hanging:!0})}}else{if(!Array.from(d.KE.nodes(n,{at:l,match:e=>n.isTextSpan(e)}))?.at(0))return;let[e,t]=d.KE.node(n,l,{depth:1}),r=n.isTextBlock(e)&&1===e.children.length&&n.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(r){let e=r.marks??[],o=e.filter(e=>e!==i);d.gB.setNodes(n,{marks:e.length===o.length?[...e,i]:o},{at:t,match:e=>n.isTextSpan(e)})}else{let e={...d.KE.marks(n)||{}}.marks||[],t={...d.KE.marks(n)||{},marks:[...e,i]};n.marks=t}}if(n.selection){let e=n.selection;n.selection={...e}}},"decorator.remove":({action:e})=>{let t=e.editor,n=e.decorator,{selection:i}=t;if(i){if(d.Q6.isExpanded(i))d.gB.setNodes(t,{},{match:d.EY.isText,split:!0,hanging:!0}),t.selection&&[...d.KE.nodes(t,{at:t.selection,match:d.EY.isText})].forEach(([e,i])=>{let r=t.children[i[0]];d.Hg.isElement(r)&&r.children.includes(e)&&d.gB.setNodes(t,{marks:(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==n),_type:"span"},{at:i})});else{let[e,r]=d.KE.node(t,i,{depth:1}),o=t.isTextBlock(e)&&1===e.children.length&&t.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(o){let e=(o.marks??[]).filter(e=>e!==n);d.gB.setNodes(t,{marks:e},{at:r,match:e=>t.isTextSpan(e)})}else{let e={...d.KE.marks(t)||{}}.marks||[],i={...d.KE.marks(t)||{},marks:e.filter(e=>e!==n)};t.marks={marks:i.marks,_type:"span"}}}if(t.selection){let e=t.selection;t.selection={...e}}}},focus:({action:e})=>{a.rL.focus(e.editor)},delete:({action:e})=>{let t=V(e.selection,e.editor);if(!t)throw Error(`Failed to get Slate Range for selection ${JSON.stringify(e.selection)}`);e.editor.delete({at:t})},"delete.backward":({action:e})=>{e.editor.deleteBackward(e.unit)},"delete.forward":({action:e})=>{e.editor.deleteForward(e.unit)},"delete.block":({action:e})=>{let t=V({anchor:{path:e.at,offset:0},focus:{path:e.at,offset:0}},e.editor);if(!t){console.error("Unable to find Slate range from selection points");return}d.gB.removeNodes(e.editor,{at:t})},"delete.text":({context:e,action:t})=>{let n=H(t.editor.children,e.schema.block.name,eo.get(t.editor)),i=(0,P.lv)({value:n,offsets:{anchor:t.anchor,focus:t.focus}});if(!i)throw Error("Unable to find selection from block offsets");let r=(0,K.bu)({context:{converters:[],schema:e.schema,keyGenerator:e.keyGenerator,activeDecorators:[],readOnly:!1,value:n,selection:i}});if(!r)throw Error("Unable to find trimmed selection");let o=V(r,t.editor);if(!o)throw Error("Unable to find Slate range from trimmed selection");d.gB.delete(t.editor,{at:o})},"history.redo":({action:e})=>{let t=e.editor,{redos:n}=t.history,i=tc(t);if(n.length>0){let e=n[n.length-1];if(to("Redoing",e),e.operations.length>0){let n=i.filter(t=>t.time>=e.timestamp),r=e.operations;n.forEach(e=>{r=m(r.map(n=>td(t,e.patch,n,e.snapshot,e.previousSnapshot)))});try{d.KE.withoutNormalizing(t,()=>{!function(e,t){let n=e5(e);e4.set(e,!0),t(),e4.set(e,n)}(t,()=>{tg(t,()=>{r.forEach(e=>{t.apply(e)})})})})}catch(e){to("Could not perform redo step",e),i.splice(0,i.length),d.gB.deselect(t),t.history={undos:[],redos:[]},ta.set(t,!0),e4.set(t,!1),t.onChange();return}t.history.undos.push(e),t.history.redos.pop()}}},"history.undo":({action:e})=>{let t=e.editor,{undos:n}=t.history,i=tc(t);if(n.length>0){let e=n[n.length-1];if(to("Undoing",e),e.operations.length>0){let n=i.filter(t=>t.time>=e.timestamp),r=e.operations;n.forEach(e=>{r=m(r.map(n=>td(t,e.patch,n,e.snapshot,e.previousSnapshot)))});let o=r.map(d.I.inverse).reverse();try{d.KE.withoutNormalizing(t,()=>{!function(e,t){let n=e6(e);e3.set(e,!0),t(),e3.set(e,n)}(t,()=>{tg(t,()=>{o.forEach(e=>{t.apply(e)})})})})}catch(e){to("Could not perform undo step",e),i.splice(0,i.length),d.gB.deselect(t),t.history={undos:[],redos:[]},ta.set(t,!0),e3.set(t,!1),t.onChange();return}t.history.redos.push(e),t.history.undos.pop()}}},"insert.block":({context:e,action:t})=>{let n=(0,x.rT)({block:t.block,context:e,options:{refreshKeys:!1}});if(!n)throw Error(`Failed to parse block ${JSON.stringify(t.block)}`);let i=q([n],{schemaTypes:e.schema})[0];if(!i)throw Error(`Failed to convert block to Slate fragment ${JSON.stringify(n)}`);!function({block:e,placement:t,select:n,editor:i,schema:r}){let[o,a]=F({editor:i});if(i.selection&&o&&a){if("before"===t){let t=i.selection;d.gB.insertNodes(i,[e],{at:a,select:!1});let r=d.Q6.transform(t,{type:"move_node",path:a,newPath:[a[0]+1]});r?d.gB.select(i,r):d.gB.select(i,t),"start"===n?d.gB.select(i,d.KE.start(i,a)):"end"===n&&d.gB.select(i,d.KE.end(i,a))}else if("after"===t){let t=[a[0]+1],r=i.selection;d.gB.insertNodes(i,[e],{at:t,select:!1}),d.gB.select(i,r),"start"===n?d.gB.select(i,d.KE.start(i,t)):"end"===n&&d.gB.select(i,d.KE.end(i,t))}else{let t=i.selection,s=d.KE.start(i,a);if(i.isTextBlock(o)&&i.isTextBlock(e)){if("end"===n){d.gB.insertFragment(i,[e],{voids:!0});return}d.gB.insertFragment(i,[e],{at:t,voids:!0}),"start"===n?d.bR.equals(t.anchor,s)?d.gB.select(i,d.KE.start(i,a)):d.gB.select(i,t):d.bR.equals(t.anchor,s)||d.gB.select(i,t)}else if(i.isTextBlock(o)){let s=d.KE.start(i,a),l=d.KE.end(i,a);if(d.bR.equals(t.anchor,s))d.gB.insertNodes(i,[e],{at:a,select:!1}),("start"===n||"end"===n)&&d.gB.select(i,d.KE.start(i,a)),Q([o],r)&&d.gB.removeNodes(i,{at:d.wA.next(a)});else if(d.bR.equals(t.focus,l)){let t=[a[0]+1];d.gB.insertNodes(i,[e],{at:t,select:!1}),("start"===n||"end"===n)&&d.gB.select(i,d.KE.start(i,t))}else{let t=i.selection,[r]=function({editor:e}){let[t,n]=F({editor:e}),i=e.selection?.focus.path.at(1);if(!t||!n||void 0===i)return[void 0,void 0];let r=d.bP.child(t,i);return r?[r,[...n,i]]:[void 0,void 0]}({editor:i});if(r&&i.isTextSpan(r))d.gB.insertFragment(i,[e],{at:t}),"start"===n||"end"===n?d.gB.select(i,[a[0]+1]):d.gB.select(i,t);else{let r=[a[0]+1];d.gB.insertNodes(i,[e],{at:r,select:!1}),d.gB.select(i,t),"start"===n?d.gB.select(i,d.KE.start(i,r)):"end"===n&&d.gB.select(i,d.KE.end(i,r))}}}else{d.gB.insertNodes(i,[e],{select:!1});let t=[a[0]+1];"start"===n?d.gB.select(i,d.KE.start(i,t)):"end"===n&&d.gB.select(i,d.KE.end(i,t))}}}else{"none"!==n&&O.wE.focus(i);let[o,a]=X({editor:i});if("before"===t)d.gB.insertNodes(i,[e],{at:[0]}),"start"===n?d.gB.select(i,d.KE.start(i,[0])):"end"===n&&d.gB.select(i,d.KE.end(i,[0]));else if("after"===t){let t=a?[a[0]+1]:[0];d.gB.insertNodes(i,[e],{at:t,select:!1}),"start"===n?d.gB.select(i,d.KE.start(i,t)):"end"===n&&d.gB.select(i,d.KE.end(i,t))}else{if(o&&Q([o],r)){d.gB.removeNodes(i,{at:a}),d.gB.insertNodes(i,[e],{at:a,select:!1}),d.gB.deselect(i),"start"===n?d.gB.select(i,d.KE.start(i,a)):"end"===n&&d.gB.select(i,d.KE.end(i,a));return}if(i.isTextBlock(e)&&o&&i.isTextBlock(o)){let t=d.KE.end(i,a);d.gB.insertFragment(i,[e],{at:d.KE.end(i,a)}),"start"===n?d.gB.select(i,t):"none"===n&&d.gB.deselect(i);return}let t=a?[a[0]+1]:[0];d.gB.insertNodes(i,[e],{at:t,select:!1}),"start"===n?d.gB.select(i,d.KE.start(i,t)):"end"===n&&d.gB.select(i,d.KE.end(i,t))}}}({block:i,placement:t.placement,select:t.select??"start",editor:t.editor,schema:e.schema})},"insert.break":({context:e,action:t})=>{let n=e.keyGenerator,i=e.schema,r=t.editor;if(!r.selection)return;let o=r.selection.anchor.path.slice(0,1),a=r.selection.focus.path.slice(0,1),s=d.bP.descendant(r,a);if(r.isTextBlock(s)&&o[0]===a[0]){d.gB.splitNodes(r,{at:r.selection,always:!0});let[t,o]=d.KE.node(r,d.wA.next(a),{depth:1}),s=d.bP.child(t,0);if(r.isTextSpan(s)||d.gB.insertNodes(r,{_key:e.keyGenerator(),_type:"span",text:"",marks:[]},{at:[o[0],0]}),d.gB.setSelection(r,{anchor:{path:[...o,0],offset:0},focus:{path:[...o,0],offset:0}}),r.isTextBlock(t)&&t.markDefs&&t.markDefs.length>0){let e=new Map,s=Array.from(d.bP.children(r,a)).map(e=>e[0]).filter(e=>r.isTextSpan(e));for(let[t,a]of d.bP.children(r,o)){if(!r.isTextSpan(t))continue;let o=t.marks??[];for(let t of o)i.decorators.some(e=>e.value===t)||s.some(e=>e.marks?.includes(t))&&!e.has(t)&&e.set(t,n());let l=o.map(t=>e.get(t)??t);c(o,l)||d.gB.setNodes(r,{marks:l},{at:a})}let l=t.markDefs.map(t=>({...t,_key:e.get(t._key)??t._key}));c(t.markDefs,l)||d.gB.setNodes(r,{markDefs:l},{at:o,match:e=>r.isTextBlock(e)})}return}d.gB.splitNodes(r,{always:!0})},"insert.inline object":({context:e,action:t})=>{if(!e.schema.inlineObjects.some(e=>e.name===t.inlineObject.name)){console.error("Unable to insert unknown inline object");return}if(!t.editor.selection){console.error("Unable to insert inline object without selection");return}let[n]=Array.from(d.KE.nodes(t.editor,{at:t.editor.selection.focus.path,match:e=>t.editor.isTextBlock(e)})).at(0)??[void 0,void 0];if(!n){console.error("Unable to perform action without focus text block");return}let i=q([{_type:e.schema.block.name,_key:e.keyGenerator(),children:[{_type:t.inlineObject.name,_key:e.keyGenerator(),...t.inlineObject.value??{}}]}],{schemaTypes:e.schema}).at(0)?.children.at(0);if(!i){console.error("Unable to insert inline object");return}d.gB.insertNodes(t.editor,i)},"insert.soft break":tA,"insert.span":({context:e,action:t})=>{if(!t.editor.selection){console.error("Unable to perform action without selection",t);return}let[n,i]=Array.from(d.KE.nodes(t.editor,{at:t.editor.selection.focus.path,match:e=>t.editor.isTextBlock(e)}))[0]??[void 0,void 0];if(!n||!i){console.error("Unable to perform action without focus block",t);return}let r=n.markDefs??[],o=t.annotations?t.annotations.map(t=>({_type:t.name,_key:e.keyGenerator(),...t.value})):void 0;o&&o.length>0&&d.gB.setNodes(t.editor,{markDefs:[...r,...o]}),d.gB.insertNodes(t.editor,{_type:"span",_key:e.keyGenerator(),text:t.text,marks:[...o?.map(e=>e._key)??[],...t.decorators??[]]})},"insert.text":({action:e})=>{e.editor.insertText(e.text)},effect:({action:e})=>{e.effect()},"move.block":tD,"move.block down":({context:e,action:t})=>{let n=[R(t.at,t.editor)[0]],i=[d.wA.next(n)[0]],r=U(t.editor.children,{anchor:{path:i,offset:0},focus:{path:i,offset:0}},e.schema),o=r&&(0,_.wE)(r.focus.path[0])?r.focus.path[0]._key:void 0;if(void 0===o){console.error("Could not find destination block key");return}tD({action:{at:t.at,to:[{_key:o}],editor:t.editor}})},"move.block up":({context:e,action:t})=>{let n=[R(t.at,t.editor)[0]];if(!d.wA.hasPrevious(n))return;let i=[d.wA.previous(n)[0]],r=U(t.editor.children,{anchor:{path:i,offset:0},focus:{path:i,offset:0}},e.schema),o=r&&(0,_.wE)(r.focus.path[0])?r.focus.path[0]._key:void 0;if(void 0===o){console.error("Could not find destination block key");return}tD({action:{at:t.at,to:[{_key:o}],editor:t.editor}})},select:({action:e})=>{let t=V(e.selection,e.editor);t?d.gB.select(e.editor,t):d.gB.deselect(e.editor)}};function tM({context:e,action:t}){switch(t$(JSON.stringify(N(t,["editor"]),null,2)),t.type){case"annotation.add":tj["annotation.add"]({context:e,action:t});break;case"annotation.remove":tj["annotation.remove"]({context:e,action:t});break;case"block.set":tj["block.set"]({context:e,action:t});break;case"block.unset":tj["block.unset"]({context:e,action:t});break;case"blur":tj.blur({context:e,action:t});break;case"decorator.add":tj["decorator.add"]({context:e,action:t});break;case"decorator.remove":tj["decorator.remove"]({context:e,action:t});break;case"delete":tj.delete({context:e,action:t});break;case"delete.backward":tj["delete.backward"]({context:e,action:t});break;case"delete.block":tj["delete.block"]({context:e,action:t});break;case"delete.forward":tj["delete.forward"]({context:e,action:t});break;case"delete.text":tj["delete.text"]({context:e,action:t});break;case"effect":tj.effect({context:e,action:t});break;case"focus":tj.focus({context:e,action:t});break;case"history.redo":tj["history.redo"]({context:e,action:t});break;case"history.undo":tj["history.undo"]({context:e,action:t});break;case"insert.block":tj["insert.block"]({context:e,action:t});break;case"insert.inline object":tj["insert.inline object"]({context:e,action:t});break;case"insert.break":tj["insert.break"]({context:e,action:t});break;case"insert.soft break":tj["insert.soft break"]({context:e,action:t});break;case"insert.span":tj["insert.span"]({context:e,action:t});break;case"insert.text":tj["insert.text"]({context:e,action:t});break;case"move.block":tj["move.block"]({context:e,action:t});break;case"move.block down":tj["move.block down"]({context:e,action:t});break;case"move.block up":tj["move.block up"]({context:e,action:t});break;case"noop":break;default:tj.select({context:e,action:t})}}let tG=I("applyPatches"),tI=tG.enabled&&!0;function tL(e){return"object"==typeof e&&"_key"in e}function tR(e,t){tI&&(tG(`Children ${t}:`,JSON.stringify(e.children,null,2)),tG(`Selection ${t}: `,JSON.stringify(e.selection,null,2)))}function tU(e,t){let{block:n,path:i}=function(e,t){let n=-1,i=e.children.find((e,i)=>{let r=tL(t[0])?e._key===t[0]._key:i===t[0];return r&&(n=i),r});return i?{block:i,path:[n]}:{}}(e,t);if(!(d.Hg.isElement(n)&&"children"===t[1]))return{block:n,blockPath:i,child:void 0,childPath:void 0};let r=-1,o=n.children.find((e,n)=>{let i=tL(t[2])?e._key===t[2]._key:n===t[2];return i&&(r=n),i});return o?{block:n,child:o,blockPath:i,childPath:i?.concat(r)}:{block:n,blockPath:i,child:void 0,childPath:void 0}}let tV=I("plugin:withPatches"),tJ=I("plugin:withPlaceholderBlock"),tW=I("plugin:withPortableTextBlockStyle");I("plugin:withPortableTextSelections");let tY=I("plugin:withSchemaTypes"),tq=(e,t)=>{let{editorActor:n}=t,i=n.getSnapshot().context.schema,r=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,i){let r=i[n.path[0]],o=e.isTextBlock(r);if(1===n.path.length){let e=0===n.path[0]?"before":"after",o=i[n.path[0]-1],a=0===n.path[0]?r?._key:o?._key;return a?[(0,g.Yr)([H([n.node],t)[0]],e,[{_key:a}])]:[(0,g.Wm)(i,[]),(0,g.Yr)([H([n.node],t)[0]],"before",[n.path[0]])]}if(o&&2===n.path.length&&e.children[n.path[0]]){let e=0!==r.children.length&&r.children[n.path[1]-1]?"after":"before",i={...n.node};!i._type&&d.EY.isText(i)&&(i._type="span",i.marks=[]);let o=H([{_key:"bogus",_type:t,children:[i]}],t)[0].children[0];return[(0,g.Yr)([o],e,[{_key:r._key},"children",r.children.length<=1||!r.children[n.path[1]-1]?0:{_key:r.children[n.path[1]-1]._key}])]}return tS("Something was inserted into a void block. Not producing editor patches."),[]},insertTextPatch:function(e,t,n){tS.enabled&&tS("Operation",JSON.stringify(t,null,2));let i=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&e.isTextSpan(i.children[t.path[1]])&&i.children[t.path[1]];if(!r)throw Error("Could not find child");let o=[{_key:i._key},"children",{_key:r._key},"text"],a=n[t.path[0]],s=e.isTextBlock(a)&&a.children[t.path[1]],l=e.isTextSpan(s)?s.text:"",c=(0,g.jo)(l,r.text,o);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,i){let r=[],o=i[n.path[0]],a=e.children[n.path[0]];if(1===n.path.length){if(o?._key){let i=H([e.children[n.path[0]-1]],t)[0];r.push((0,g.hZ)(i,[{_key:i._key}])),r.push((0,g.wC)([{_key:o._key}]))}else throw Error("Target key not found!")}else if(e.isTextBlock(o)&&e.isTextBlock(a)&&2===n.path.length){let t=a.children[n.path[1]-1]&&e.isTextSpan(a.children[n.path[1]-1])?a.children[n.path[1]-1]:void 0,i=o.children[n.path[1]]&&e.isTextSpan(o.children[n.path[1]])?o.children[n.path[1]]:void 0;t&&(1===o.children.filter(e=>e._key===t._key).length?r.push((0,g.hZ)(t.text,[{_key:o._key},"children",{_key:t._key},"text"])):console.warn(`Multiple spans have \`_key\` ${t._key}. It's ambiguous which one to update.`,JSON.stringify(o,null,2))),i&&(1===o.children.filter(e=>e._key===i._key).length?r.push((0,g.wC)([{_key:o._key},"children",{_key:i._key}])):console.warn(`Multiple spans have \`_key\` ${i._key}. It's ambiguous which one to remove.`,JSON.stringify(o,null,2)))}else tS("Void nodes can't be merged, not creating any patches");return r},moveNodePatch:function(e,n,i){let r=[],o=i[n.path[0]],a=i[n.newPath[0]];if(!a)return r;if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";r.push((0,g.wC)([{_key:o._key}])),r.push((0,g.Yr)([H([o],t)[0]],e,[{_key:a._key}]))}else if(2===n.path.length&&e.isTextBlock(o)&&e.isTextBlock(a)){let e=o.children[n.path[1]],i=a.children[n.newPath[1]],s=n.newPath[1]===a.children.length?"after":"before",l=H([o],t)[0].children[n.path[1]];r.push((0,g.wC)([{_key:o._key},"children",{_key:e._key}])),r.push((0,g.Yr)([l],s,[{_key:a._key},"children",{_key:i._key}]))}return r},removeNodePatch:function(e,t,n){let i=n[t.path[0]];if(1===t.path.length){if(i&&i._key)return[(0,g.wC)([{_key:i._key}])];throw Error("Block not found")}if(!e.isTextBlock(i)||2!==t.path.length)return tS("Not creating patch inside object block"),[];{let e=i.children[t.path[1]];return e?i.children.filter(e=>e._key===t.node._key).length>1?(console.warn(`Multiple spans have \`_key\` ${t.node._key}. It's ambiguous which one to remove.`,JSON.stringify(i,null,2)),[]):[(0,g.wC)([{_key:i._key},"children",{_key:e._key}])]:(tS("Span not found in editor trying to remove node"),[])}},removeTextPatch:function(e,t,n){let i=e&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&i.children[t.path[1]]||void 0,o=e.isTextSpan(r)?r:void 0;if(r&&!o)throw Error("Expected span");if(!o)throw Error("Could not find child");let a=[{_key:i._key},"children",{_key:o._key},"text"],s=n[t.path[0]],l=e.isTextBlock(s)&&s.children[t.path[1]],c=e.isTextSpan(l)&&l.text,d=(0,g.jo)(c||"",o.text,a);return d.value?[d]:[]},setNodePatch:function(e,n){if(1===n.path.length){let i=e.children[n.path[0]];if("string"!=typeof i._key)throw Error("Expected block to have a _key");let r=A({...e.children[n.path[0]],...n.newProperties},S);return[(0,g.hZ)(H([r],t)[0],[{_key:i._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let i=t._key,r=e._key,o=[],a=Object.keys(n.newProperties);return a.forEach(s=>{if(1===a.length&&"_key"===s){let r=T(n.newProperties,s);o.push((0,g.hZ)(r,[{_key:i},"children",t.children.indexOf(e),s]))}else{let e=T(n.newProperties,s);o.push((0,g.hZ)(e,[{_key:i},"children",{_key:r},s]))}}),o}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error(`Unexpected path encountered: ${JSON.stringify(n.path)}`)},splitNodePatch:function(e,n,i){let r=[],o=e.children[n.path[0]];if(!e.isTextBlock(o))throw Error(`Block with path ${JSON.stringify(n.path[0])} is not a text block and can't be split`);if(1===n.path.length){let a=i[n.path[0]];if(e.isTextBlock(a)){let i=H([e.children[n.path[0]+1]],t)[0];i&&(r.push((0,g.Yr)([i],"after",[{_key:o._key}])),a.children.slice(n.position).forEach(e=>{let t=[{_key:a._key},"children",{_key:e._key}];r.push((0,g.wC)(t))}))}return r}if(2===n.path.length){let i=o.children[n.path[1]];if(e.isTextSpan(i)){let e=H([{...o,children:o.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;r.push((0,g.Yr)(e,"after",[{_key:o._key},"children",{_key:i._key}])),r.push((0,g.hZ)(i.text,[{_key:o._key},"children",{_key:i._key},"text"]))}}return r}}}(i),o=function(e,t){return function(n){let{apply:i,normalizeNode:r}=n;return n.apply=t=>{if(ef(n)||e6(n)||e5(n)){i(t);return}if("split_node"===t.type){let r=[...d.bP.descendants(n)].map(([e])=>e._key);i({...t,properties:{...t.properties,_key:void 0===t.properties._key||r.includes(t.properties._key)?e.getSnapshot().context.keyGenerator():t.properties._key}});return}if("insert_node"===t.type&&!d.KE.isEditor(t.node)){let r=[...d.bP.descendants(n)].map(([e])=>e._key);i({...t,node:{...t.node,_key:void 0===t.node._key||r.includes(t.node._key)?e.getSnapshot().context.keyGenerator():t.node._key}});return}i(t)},n.normalizeNode=i=>{let[o,a]=i;if(d.Hg.isElement(o)&&o._type===t.block.name){if(!o._key){e.send({type:"normalizing"}),d.gB.setNodes(n,{_key:e.getSnapshot().context.keyGenerator()},{at:a}),e.send({type:"done normalizing"});return}for(let[t,i]of d.bP.children(n,a))if(!t._key){e.send({type:"normalizing"}),d.gB.setNodes(n,{_key:e.getSnapshot().context.keyGenerator()},{at:i}),e.send({type:"done normalizing"});return}}r(i)},n}}(n,i),a=function({editorActor:e,schemaTypes:t}){return function(n){n.isTextBlock=e=>(0,y.L4)(e)&&e._type===t.block.name,n.isTextSpan=e=>(0,y.bn)(e)&&e._type===t.span.name,n.isListBlock=e=>(0,y.U4)(e)&&e._type===t.block.name,n.isVoid=e=>t.block.name!==e._type&&(t.blockObjects.map(e=>e.name).includes(e._type)||t.inlineObjects.map(e=>e.name).includes(e._type)),n.isInline=e=>t.inlineObjects.map(e=>e.name).includes(e._type)&&"__inline"in e&&!0===e.__inline;let{normalizeNode:i}=n;return n.normalizeNode=r=>{let[o,a]=r;if(void 0===o._type&&2===a.length){tY("Setting span type on text node without a type");let i=o._key||e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),d.gB.setNodes(n,{...o,_type:t.span.name,_key:i},{at:a}),e.send({type:"done normalizing"});return}if(void 0===o._key&&(1===a.length||2===a.length)){tY("Setting missing key on child node without a key");let t=e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),d.gB.setNodes(n,{_key:t},{at:a}),e.send({type:"done normalizing"});return}i(r)},n}}({editorActor:n,schemaTypes:i}),s=function({editorActor:e,patchFunctions:t,schemaTypes:n,subscriptions:i}){let r;let o=(e,t)=>{let i=!1;tI&&(tG(`

NEW PATCH =============================================================`),tG(JSON.stringify(t,null,2)));try{switch(t.type){case"insert":i=function(e,t,n){let{block:i,child:r,blockPath:o,childPath:a}=tU(e,t.path);if(!i||!o)return tG("Block not found"),!1;if(t.path.length>1&&"children"!==t.path[1])return tG("Ignoring patch targeting void value"),!1;if(1===t.path.length){let{items:i,position:r}=t,a=q(i,{schemaTypes:n},er.get(e)),s=o[0],l="after"===r?s+1:s;return tG(`Inserting blocks at path [${l}]`),tR(e,"before"),d.gB.insertNodes(e,a,{at:[l]}),tR(e,"after"),!0}let{items:s,position:l}=t;if(!r||!a)return tG("Child not found"),!1;let c=i&&q([{...i,children:s}],{schemaTypes:n},er.get(e)),h=a[1],p=[a[0],"after"===l?h+1:h];return tG(`Inserting children at path ${p}`),tR(e,"before"),c&&d.Hg.isElement(c[0])&&d.gB.insertNodes(e,c[0].children,{at:p}),tR(e,"after"),!0}(e,t,n);break;case"unset":i=function(e,t){if(0===t.path.length){tG("Removing everything"),tR(e,"before");let t=e.selection;return d.gB.deselect(e),e.children.forEach((t,n)=>{d.gB.removeNodes(e,{at:[n]})}),d.gB.insertNodes(e,e.pteCreateTextBlock({decorators:[]})),t&&d.gB.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),tR(e,"after"),!0}let{block:n,blockPath:i,child:r,childPath:o}=tU(e,t.path);if(1===t.path.length){if(!n||!i)return tG("Block not found"),!1;let t=i[0];return tG(`Removing block at path [${t}]`),tR(e,"before"),d.gB.removeNodes(e,{at:[t]}),tR(e,"after"),!0}return!!e.isTextBlock(n)&&"children"===t.path[1]&&3===t.path.length&&(r&&o?(tG(`Unsetting child at path ${JSON.stringify(o)}`),tR(e,"before"),tI&&tG(`Removing child at path ${JSON.stringify(o)}`),d.gB.removeNodes(e,{at:o}),tR(e,"after"),!0):(tG("Child not found"),!1))}(e,t);break;case"set":i=function(e,t){let n=t.value;"string"==typeof t.path[3]&&((n={})[t.path[3]]=t.value);let{block:i,blockPath:r,child:o,childPath:a}=tU(e,t.path);if(!i)return tG("Block not found"),!1;let s=e.isTextBlock(i);if(s&&t.path.length>1&&"children"!==t.path[1])return tG("Ignoring setting void value"),!1;if(tR(e,"before"),s&&o&&a){if(d.EY.isText(n)&&d.EY.isText(o)){let t=o.text;n.text!==t&&(tG("Setting text property"),e.apply({type:"remove_text",path:a,offset:0,text:t}),e.apply({type:"insert_text",path:a,offset:0,text:n.text}),e.onChange())}else tG("Setting non-text property"),e.apply({type:"set_node",path:a,properties:{},newProperties:n});return!0}if(d.Hg.isElement(i)&&1===t.path.length&&r){tG("Setting block property");let{children:t,...o}=n,{children:a,...s}=i||{children:void 0};e.apply({type:"set_node",path:r,properties:{...s},newProperties:o}),tG("Setting children"),i.children.forEach((t,n)=>{e.apply({type:"remove_node",path:r.concat(i.children.length-1-n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:r.concat(n),node:t})})}else if(i&&"value"in i){if(!(t.path.length>1)||"children"===t.path[1])return!1;{let n=(0,g.yl)(i.value,[{...t,path:t.path.slice(1)}]);d.gB.setNodes(e,{...i,value:n},{at:r})}}return tR(e,"after"),!0}(e,t);break;case"diffMatchPatch":i=function(e,t){let{block:n,child:i,childPath:r}=tU(e,t.path);if(!n)return tG("Block not found"),!1;if(!i||!r)return tG("Child not found"),!1;if(!(n&&e.isTextBlock(n)&&4===t.path.length&&"children"===t.path[1]&&"text"===t.path[3])||!d.EY.isText(i))return!1;let[o]=function(e,t,n={}){if("string"==typeof e)throw Error("Patches must be an array - pass the patch to `parsePatch()` first");let i=t;if(0===e.length)return[i,[]];let r=function(e,t,n={}){let i=0,r=0;function o(e){for(;i<e;){let e=t.codePointAt(r);if(typeof e>"u")return r;i+=eX(e),e>65535?r+=2:r+=1}if(!n.allowExceedingIndices&&i!==e)throw Error("Failed to determine byte offset");return r}let a=[];for(let t of e)a.push({diffs:t.diffs.map(e=>em(e)),start1:o(t.start1),start2:o(t.start2),utf8Start1:t.utf8Start1,utf8Start2:t.utf8Start2,length1:t.length1,length2:t.length2,utf8Length1:t.utf8Length1,utf8Length2:t.utf8Length2});return a}(e,i,{allowExceedingIndices:n.allowExceedingIndices}),o=n.margin||4,a=n.deleteThreshold||.4,s=function(e,t=4){let n="";for(let e=1;e<=t;e++)n+=String.fromCharCode(e);for(let n of e)n.start1+=t,n.start2+=t,n.utf8Start1+=t,n.utf8Start2+=t;let i=e[0],r=i.diffs;if(0===r.length||0!==r[0][0])r.unshift([0,n]),i.start1-=t,i.start2-=t,i.utf8Start1-=t,i.utf8Start2-=t,i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[0][1].length){let e=r[0][1].length,o=t-e;r[0][1]=n.substring(e)+r[0][1],i.start1-=o,i.start2-=o,i.utf8Start1-=o,i.utf8Start2-=o,i.length1+=o,i.length2+=o,i.utf8Length1+=o,i.utf8Length2+=o}if(0===(r=(i=e[e.length-1]).diffs).length||0!==r[r.length-1][0])r.push([0,n]),i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[r.length-1][1].length){let e=t-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,e),i.length1+=e,i.length2+=e,i.utf8Length1+=e,i.utf8Length2+=e}return n}(r,o);i=s+i+s,function(e,t=4){for(let n=0;n<e.length;n++){if(e[n].length1<=32)continue;let i=e[n];e.splice(n--,1);let r=i.start1,o=i.start2,a="";for(;0!==i.diffs.length;){let s=e0(r-a.length,o-a.length),l=!0;if(""!==a){let e=eZ(a);s.length1=a.length,s.utf8Length1=e,s.length2=a.length,s.utf8Length2=e,s.diffs.push([0,a])}for(;0!==i.diffs.length&&s.length1<32-t;){let e=i.diffs[0][0],n=i.diffs[0][1],a=eZ(n);if(1===e){s.length2+=n.length,s.utf8Length2+=a,o+=n.length;let e=i.diffs.shift();e&&s.diffs.push(e),l=!1}else -1===e&&1===s.diffs.length&&0===s.diffs[0][0]&&n.length>64?(s.length1+=n.length,s.utf8Length1+=a,r+=n.length,l=!1,s.diffs.push([e,n]),i.diffs.shift()):(a=eZ(n=n.substring(0,32-s.length1-t)),s.length1+=n.length,s.utf8Length1+=a,r+=n.length,0===e?(s.length2+=n.length,s.utf8Length2+=a,o+=n.length):l=!1,s.diffs.push([e,n]),n===i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(n.length))}a=(a=eQ(s.diffs)).substring(a.length-t);let c=eH(i.diffs).substring(0,t),d=eZ(c);""!==c&&(s.length1+=c.length,s.length2+=c.length,s.utf8Length1+=d,s.utf8Length2+=d,0!==s.diffs.length&&0===s.diffs[s.diffs.length-1][0]?s.diffs[s.diffs.length-1][1]+=c:s.diffs.push([0,c])),l||e.splice(++n,0,s)}}}(r,o);let l=0,c=[];for(let e=0;e<r.length;e++){let t=r[e].start2+l,n=eH(r[e].diffs),o,s=-1;if(n.length>32?-1!==(o=eq(i,n.substring(0,32),t))&&(-1===(s=eq(i,n.substring(n.length-32),t+n.length-32))||o>=s)&&(o=-1):o=eq(i,n,t),-1===o)c[e]=!1,l-=r[e].length2-r[e].length1;else{let d;if(c[e]=!0,l=o-t,d=-1===s?i.substring(o,o+n.length):i.substring(o,s+32),n===d)i=i.substring(0,o)+eQ(r[e].diffs)+i.substring(o+n.length);else{let t=eN(n,d,{checkLines:!1});if(n.length>32&&function(e){let t=0,n=0,i=0;for(let r=0;r<e.length;r++){let o=e[r][0],a=e[r][1];switch(o){case 1:n+=a.length;break;case -1:i+=a.length;break;case 0:t+=Math.max(n,i),n=0,i=0;break;default:throw Error("Unknown diff operation.")}}return t+Math.max(n,i)}(t)/n.length>a)c[e]=!1;else{t=eG(t);let n=0,a=0;for(let s=0;s<r[e].diffs.length;s++){let l=r[e].diffs[s];0!==l[0]&&(a=eF(t,n)),1===l[0]?i=i.substring(0,o+a)+l[1]+i.substring(o+a):-1===l[0]&&(i=i.substring(0,o+a)+i.substring(o+eF(t,n+l[1].length))),-1!==l[0]&&(n+=l[1].length)}}}}}return[i=i.substring(s.length,i.length-s.length),c]}(e2(t.value),i.text,{allowExceedingIndices:!0}),a=function(e,t=4){let n=e.map(e=>em(e)),i=!1,r=[],o=0,a=null,s=0,l=!1,c=!1,d=!1,h=!1;for(;s<n.length;)0===n[s][0]?(n[s][1].length<t&&(d||h)?(r[o++]=s,l=d,c=h,a=n[s][1]):(o=0,a=null),d=!1,h=!1):(-1===n[s][0]?h=!0:d=!0,a&&(l&&c&&d&&h||a.length<t/2&&3===function(...e){return e.reduce((e,t)=>e+ +!!t,0)}(l,c,d,h))&&(n.splice(r[o-1],0,[-1,a]),n[r[o-1]+1][0]=1,o--,a=null,l&&c?(d=!0,h=!0,o=0):(s=--o>0?r[o-1]:-1,d=!1,h=!1),i=!0)),s++;return i&&(n=eI(n)),n}(eN(i.text,o),5);tR(e,"before");let s=0;for(let[t,n]of a)1===t?(e.apply({type:"insert_text",path:r,offset:s,text:n}),s+=n.length):-1===t?e.apply({type:"remove_text",path:r,offset:s,text:n}):0===t&&(s+=n.length);return tR(e,"after"),!0}(e,t);break;default:tG("Unhandled patch",t.type)}}catch(e){console.error(e)}return i};return function(a){ei.set(a,!1),eg.set(a,!0),r=[...a.children];let{apply:s}=a,l=[],c=()=>{if(0===l.length)return;let e=l;l=[];let t=!1;eu(a,()=>{d.KE.withoutNormalizing(a,()=>{ey(a,()=>{tg(a,()=>{e.forEach(e=>{tV.enabled&&tV(`Handling remote patch ${JSON.stringify(e)}`),t=o(a,e)})})})}),t&&(a.normalize(),a.onChange())})},h=({patches:e})=>{let t=e.filter(e=>"local"!==e.origin);0!==t.length&&(l=l.concat(t),c())};return i.push(()=>{tV("Subscribing to remote patches");let t=e.on("patches",h);return()=>{tV("Unsubscribing to remote patches"),t.unsubscribe()}}),a.apply=i=>{let o=[],l=Q(r=a.children,n);s(i);let c=Q(a.children,n);if(!eg.get(a))return a;switch(l&&!c&&"set_selection"!==i.type&&o.push((0,g.Yr)(r,"before",[0])),i.type){case"insert_text":o=[...o,...t.insertTextPatch(a,i,r)];break;case"remove_text":o=[...o,...t.removeTextPatch(a,i,r)];break;case"remove_node":o=[...o,...t.removeNodePatch(a,i,r)];break;case"split_node":o=[...o,...t.splitNodePatch(a,i,r)];break;case"insert_node":o=[...o,...t.insertNodePatch(a,i,r)];break;case"set_node":o=[...o,...t.setNodePatch(a,i,r)];break;case"merge_node":o=[...o,...t.mergeNodePatch(a,i,r)];break;case"move_node":o=[...o,...t.moveNodePatch(a,i,r)]}if(!l&&c&&["merge_node","set_node","remove_text","remove_node"].includes(i.type)&&(o=[...o,(0,g.wC)([])],e.send({type:"notify.unset",previousValue:H(r,n.block.name,eo.get(a))})),l&&o.length>0&&(o=[(0,g.Wm)([],[]),...o]),o.length>0)for(let t of o)e.send({type:"internal.patch",patch:{...t,origin:"local"},actionId:te.get(a),value:H(a.children,n.block.name,eo.get(a))});return a},a}}({editorActor:n,patchFunctions:r,schemaTypes:i,subscriptions:t.subscriptions}),l=function(e){return function(t){let{apply:n}=t;return t.apply=i=>{if(e.getSnapshot().matches({"edit mode":"read only"})||ef(t)||e6(t)||e5(t)){n(i);return}let r=e.getSnapshot().context.maxBlocks??-1;r>0&&t.children.length>=r&&("insert_node"===i.type||"split_node"===i.type)&&1===i.path.length||n(i)},t}}(n),h=function(e){let{editorActor:t,blockSchemaType:n}=e;return i=>{let r=H(i.children,n.name),o=tc(i),a=tr(i);e.subscriptions.push(()=>{to("Subscribing to patches");let e=t.on("patches",({patches:e,snapshot:t})=>{let n=!1;e.forEach(e=>{if(!n&&"local"!==e.origin&&o){if("unset"===e.type&&0===e.path.length){to("Someone else cleared the content, resetting undo/redo history"),i.history={undos:[],redos:[]},o.splice(0,o.length),ta.set(i,!0),n=!0;return}o.push({patch:e,time:new Date,snapshot:t,previousSnapshot:r})}}),r=t});return()=>{to("Unsubscribing to patches"),e.unsubscribe()}}),i.history={undos:[],redos:[]};let{apply:s}=i;return i.apply=e=>{if(t.getSnapshot().matches({"edit mode":"read only"})||ef(i)||e6(i)||e5(i)){s(e);return}let{operations:n,history:r}=i,{undos:o}=r,l=o[o.length-1],c=l&&l.operations&&l.operations[l.operations.length-1],d=tu(e,c),h=tl(i),p=tr(i),u=(void 0===p||void 0!==a)&&(void 0===p||void 0===a||p===a);if(h){if(l?0===n.length&&(u=void 0===p&&void 0===a?tp(e,c)||d:u):u=!1,l&&u)l.operations.push(e);else{var f;let t={operations:[...null===i.selection?[]:[{type:"set_selection",properties:{...(f=i).selection},newProperties:{...f.selection}}],e],timestamp:new Date};o.push(t),to("Created new undo step",l)}for(;o.length>1e3;)o.shift();tf(e)&&(r.redos=[])}a=p,s(e)},i}}({editorActor:n,blockSchemaType:i.block,subscriptions:t.subscriptions}),p=function(e,t){return function(n){let{apply:i,normalizeNode:r}=n,o=t.decorators.map(e=>e.value);return n.normalizeNode=i=>{let[o,a]=i;if(n.isTextBlock(o))for(let[t,i]of d.bP.children(n,a)){let r=o.children[i[1]+1];if(n.isTextSpan(t)&&n.isTextSpan(r)&&t.marks?.every(e=>r.marks?.includes(e))&&r.marks?.every(e=>t.marks?.includes(e))){tO("Merging spans",JSON.stringify(t,null,2),JSON.stringify(r,null,2)),e.send({type:"normalizing"}),d.gB.mergeNodes(n,{at:[i[0],i[1]+1],voids:!0}),e.send({type:"done normalizing"});return}}if(n.isTextBlock(o)&&!Array.isArray(o.markDefs)){tO("Adding .markDefs to block node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{markDefs:[]},{at:a}),e.send({type:"done normalizing"});return}if(n.isTextSpan(o)&&!Array.isArray(o.marks)){tO("Adding .marks to span node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{marks:[]},{at:a}),e.send({type:"done normalizing"});return}if(n.isTextSpan(o)){let i=d.wA.parent(a),[r]=d.KE.node(n,i),s=t.decorators.map(e=>e.value),l=o.marks?.filter(e=>!s.includes(e));if(n.isTextBlock(r)&&""===o.text&&l&&l.length>0){tO("Removing annotations from empty span node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{marks:o.marks?.filter(e=>s.includes(e))},{at:a}),e.send({type:"done normalizing"});return}}if(n.isTextBlock(o)){let i=t.decorators.map(e=>e.value);for(let[t,r]of d.bP.children(n,a))if(n.isTextSpan(t)){let a=t.marks??[],s=a.filter(e=>!i.includes(e)&&!o.markDefs?.find(t=>t._key===e));if(s.length>0){tO("Removing orphaned annotations from span node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{marks:a.filter(e=>!s.includes(e))},{at:r}),e.send({type:"done normalizing"});return}}}if(n.isTextSpan(o)){let i=d.wA.parent(a),[r]=d.KE.node(n,i);if(n.isTextBlock(r)){let i=t.decorators.map(e=>e.value),s=o.marks??[],l=s.filter(e=>!i.includes(e)&&!r.markDefs?.find(t=>t._key===e));if(l.length>0){tO("Removing orphaned annotations from span node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{marks:s.filter(e=>!l.includes(e))},{at:a}),e.send({type:"done normalizing"});return}}}if(n.isTextBlock(o)){let t=o.markDefs??[],i=new Set,r=[];for(let e of t)i.has(e._key)||(i.add(e._key),r.push(e));if(t.length!==r.length){tO("Removing duplicate markDefs"),e.send({type:"normalizing"}),d.gB.setNodes(n,{markDefs:r},{at:a}),e.send({type:"done normalizing"});return}}if(n.isTextBlock(o)&&!n.operations.some(e=>"merge_node"===e.type&&"markDefs"in e.properties&&1===e.path.length)){let t=(o.markDefs||[]).filter(e=>o.children.find(t=>d.EY.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));if(o.markDefs&&!c(t,o.markDefs)){tO("Removing markDef not in use"),e.send({type:"normalizing"}),d.gB.setNodes(n,{markDefs:t},{at:a}),e.send({type:"done normalizing"});return}}r(i)},n.apply=r=>{if(ef(n)||e6(n)||e5(n)){i(r);return}if("set_selection"===r.type&&d.KE.marks(n)&&r.properties&&r.newProperties&&r.properties.anchor&&r.properties.focus&&r.newProperties.anchor&&r.newProperties.focus){let e=d.Q6.isCollapsed({anchor:r.properties.anchor,focus:r.properties.focus}),t=d.Q6.isCollapsed({anchor:r.newProperties.anchor,focus:r.newProperties.focus});if(e&&t){let e=Array.from(d.KE.nodes(n,{mode:"lowest",at:r.properties.focus,match:e=>n.isTextSpan(e),voids:!1}))[0]?.[0],t=Array.from(d.KE.nodes(n,{mode:"lowest",at:r.newProperties.focus,match:e=>n.isTextSpan(e),voids:!1}))[0]?.[0],i=e&&t&&r.newProperties.focus.path[0]===r.properties.focus.path[0]&&r.newProperties.focus.path[1]===r.properties.focus.path[1]+1&&e.text.length===r.properties.focus.offset&&0===r.newProperties.focus.offset,o=e&&t&&r.newProperties.focus.path[0]===r.properties.focus.path[0]&&r.newProperties.focus.path[1]===r.properties.focus.path[1]-1&&0===r.properties.focus.offset&&t.text.length===r.newProperties.focus.offset;if(i||o)return}}if("insert_node"===r.type){let{selection:t}=n;if(t){let[i,a]=d.KE.node(n,t,{depth:1}),s=tP({editor:n,blockPath:a,spanPath:r.path}),l=s?s.marks?.filter(e=>!o.includes(e)):[],c=tK({editor:n,blockPath:a,spanPath:[r.path[0],r.path[1]-1]}),h=c?c.marks?.filter(e=>!o.includes(e)):[],p=l?.filter(e=>!h?.includes(e))??[],u=p.length>0;if(u&&tN(r.node)&&r.node.marks?.some(e=>p.includes(e))){d.gB.insertNodes(n,{...r.node,_key:e.getSnapshot().context.keyGenerator(),marks:r.node.marks?.filter(e=>!p.includes(e))??[]});return}let f=h?.filter(e=>!l?.includes(e))??[],g=f.length>0;if(g&&tN(r.node)&&r.node.marks?.some(e=>f.includes(e))){d.gB.insertNodes(n,{...r.node,_key:e.getSnapshot().context.keyGenerator(),marks:r.node.marks?.filter(e=>!f.includes(e))??[]});return}let y=c?.marks?.filter(e=>o.includes(e))??[];if(y.length>0&&u&&!g&&tN(r.node)&&r.node.marks?.length===0){d.gB.insertNodes(n,{...r.node,_key:e.getSnapshot().context.keyGenerator(),marks:y});return}}}if("insert_text"===r.type){let{selection:t}=n,a=!!t&&d.Q6.isCollapsed(t);if(t&&a){let[a,s]=d.KE.node(n,t,{depth:1}),[l,c]=Array.from(d.KE.nodes(n,{mode:"lowest",at:t.focus,match:e=>n.isTextSpan(e),voids:!1}))[0]??[void 0,void 0],h=l.marks??[],p=h.filter(e=>o.includes(e)),u=h.length>p.length,f=0===l.text.length,g=0===t.anchor.offset,y=t.anchor.offset===l.text.length,m=tP({editor:n,blockPath:s,spanPath:c}),k=tK({editor:n,blockPath:s,spanPath:c}),v=k?.marks?.filter(e=>!o.includes(e))??[],b=h.filter(e=>!o.includes(e)),x=!!m&&m.marks?.some(e=>!o.includes(e)),_=!!m&&m.marks?.filter(e=>!o.includes(e)).every(e=>h.includes(e)),E=!!m&&m.marks?.some(e=>!o.includes(e)&&h.includes(e)),w=!!m&&m.marks?.every(e=>h.includes(e)),B=b.some(e=>v?.includes(e));if(u&&!f){if(g){if(w){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:m?.marks??[]});return}if(_){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:m?.marks??[]});return}if(E){i(r);return}else if(!m){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:[]});return}}if(y){if(k&&B&&v.length<b.length||!B){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:k?.marks??[]});return}if(!k){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:[]});return}}}if(g&&!f&&m){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:x?[]:(m.marks??[]).filter(e=>o.includes(e))});return}}}if("remove_text"===r.type){let{selection:e}=n;if(e&&d.Q6.isExpanded(e)){var a;let[t,s]=d.KE.node(n,e,{depth:1}),[l,c]=Array.from(d.KE.nodes(n,{mode:"lowest",at:{path:r.path,offset:r.offset},match:e=>n.isTextSpan(e),voids:!1}))[0]??[void 0,void 0];if(l&&t&&"string"==typeof(a=t)._type&&"@"!==a._type[0]&&(!("markDefs"in a)||!a.markDefs||Array.isArray(a.markDefs)&&a.markDefs.every(e=>"string"==typeof e._key))&&"children"in a&&Array.isArray(a.children)&&a.children.every(e=>"object"==typeof e&&"_type"in e)){let e=t.markDefs??[],a=l.marks??[],h=a.some(t=>e.find(e=>e._key===t)),p=r.offset+r.text.length===l.text.length,u=0===r.offset&&p,f=tP({editor:n,blockPath:s,spanPath:c}),g=tK({editor:n,blockPath:s,spanPath:c}),y=!!f&&f.marks?.some(e=>!o.includes(e)&&a.includes(e)),m=!!g&&g.marks?.some(e=>!o.includes(e)&&a.includes(e));if(h&&u&&!y&&!m){let e=(({...d.KE.marks(n)||{}}).marks||[]).filter(e=>o.includes(e));d.KE.withoutNormalizing(n,()=>{i(r),d.gB.setNodes(n,{marks:e},{at:r.path})}),n.onChange();return}}}}if("merge_node"===r.type&&1===r.path.length&&"markDefs"in r.properties&&r.properties._type===t.block.name&&Array.isArray(r.properties.markDefs)&&r.properties.markDefs.length>0&&r.path[0]-1>=0){let[e,t]=d.KE.node(n,[r.path[0]-1]);if(n.isTextBlock(e)){let o=v([...Array.isArray(e.markDefs)&&e.markDefs||[],...r.properties.markDefs]);tO("Copying markDefs over to merged block",r),d.gB.setNodes(n,{markDefs:o},{at:t,voids:!1}),i(r);return}}i(r)},n}}(n,i),u=function(e,t){let n=t.styles[0].value;return function(t){let{normalizeNode:i}=t;return t.normalizeNode=r=>{let[,o]=r;for(let i of t.operations)if("split_node"===i.type&&1===i.path.length&&t.isTextBlock(i.properties)&&i.properties.style!==n&&i.path[0]===o[0]&&!d.wA.equals(o,i.path)){let[r]=d.KE.node(t,[i.path[0]+1,0]);if(d.EY.isText(r)&&""===r.text){tW(`Normalizing split node to ${n} style`,i),e.send({type:"normalizing"}),d.gB.setNodes(t,{style:n},{at:[i.path[0]+1],voids:!1}),e.send({type:"done normalizing"});return}}i(r)},t}}(n,i),f=function({editorActor:e,schemaTypes:t}){return function(n){return n.pteCreateTextBlock=n=>q([{_type:t.block.name,_key:e.getSnapshot().context.keyGenerator(),style:t.styles[0].value||"normal",...n.listItem?{listItem:n.listItem}:{},...n.level?{level:n.level}:{},markDefs:[],children:[{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:"",marks:n.decorators.filter(e=>t.decorators.find(({value:t})=>t===e))}]}],{schemaTypes:t})[0],n}}({editorActor:n,schemaTypes:i}),m=function(e,t){let n=null;return function(i){let r=()=>{if(n!==i.selection){let n=null;if(i.selection){let e=ea.get(i.selection);e?n=e:(n=U(i.children,i.selection,t),ea.set(i.selection,n))}n?e.send({type:"notify.selection",selection:n}):e.send({type:"notify.selection",selection:null})}n=i.selection},{onChange:o}=i;return i.onChange=()=>{o(),e.getSnapshot().matches({setup:"setting up"})||r()},i}}(n,i);return(function(e,t){return function(n){if(void 0!==e.getSnapshot().context.maxBlocks)return n;t.push(()=>{let t=e.on("*",t=>{switch(t.type){case"blurred":case"done loading":case"editable":case"error":case"focused":case"invalid value":case"loading":case"mutation":case"patch":case"internal.patch":case"patches":case"read only":case"ready":case"selection":case"value changed":case"unset":break;case"custom.*":e.send({type:"custom behavior event",behaviorEvent:t.event,editor:n});break;case"insert.block object":e.send({type:"behavior event",behaviorEvent:{type:"insert.block",block:{_type:t.blockObject.name,...t.blockObject.value??{}},placement:t.placement},editor:n});break;default:e.send({type:"behavior event",behaviorEvent:t,editor:n})}});return()=>{t.unsubscribe()}});let{deleteBackward:i,deleteForward:r,insertBreak:o,insertText:a,select:s}=n;return n.deleteBackward=t=>{if(tn(n)){i(t);return}e.send({type:"behavior event",behaviorEvent:{type:"delete.backward",unit:t},editor:n})},n.deleteForward=t=>{if(tn(n)){r(t);return}e.send({type:"behavior event",behaviorEvent:{type:"delete.forward",unit:t},editor:n})},n.insertBreak=()=>{if(tn(n)){o();return}e.send({type:"behavior event",behaviorEvent:{type:"insert.break"},editor:n})},n.insertData=t=>{if(tn(n))throw Error("Unexpected call to .insertData(...)");e.send({type:"behavior event",behaviorEvent:{type:"input.*",originEvent:{dataTransfer:t}},editor:n})},n.insertSoftBreak=()=>{if(tn(n)){tA({context:{keyGenerator:e.getSnapshot().context.keyGenerator,schema:e.getSnapshot().context.schema},action:{editor:n}});return}e.send({type:"behavior event",behaviorEvent:{type:"insert.soft break"},editor:n})},n.insertText=(t,i)=>{if(tn(n)){a(t,i);return}e.send({type:"behavior event",behaviorEvent:{type:"insert.text",text:t},editor:n,defaultActionCallback:()=>{a(t,i)}})},n.redo=()=>{if(tn(n)){tM({context:{keyGenerator:e.getSnapshot().context.keyGenerator,schema:e.getSnapshot().context.schema},action:{type:"history.redo",editor:n}});return}e.send({type:"behavior event",behaviorEvent:{type:"history.redo"},editor:n})},n.select=t=>{if(tn(n)){s(t);return}let i=d.KE.range(n,t);e.send({type:"behavior event",behaviorEvent:{type:"select",selection:U(H(n.children,e.getSnapshot().context.schema.block.name,eo.get(n)),i,e.getSnapshot().context.schema)},editor:n,defaultActionCallback:()=>{s(t)}})},n.setFragmentData=()=>{console.warn("Unexpected call to .setFragmentData(...)")},n.undo=()=>{if(tn(n)){tM({context:{keyGenerator:e.getSnapshot().context.keyGenerator,schema:e.getSnapshot().context.schema},action:{type:"history.undo",editor:n}});return}e.send({type:"behavior event",behaviorEvent:{type:"history.undo"},editor:n})},n}})(n,t.subscriptions)(a(o(p(u(function(e){let{apply:t}=e;return e.apply=i=>{if(n.getSnapshot().matches({"edit mode":"read only"})||ef(e)||e6(e)||e5(e)){t(i);return}if("remove_node"===i.type){let t=i.node;if(0===i.path[0]&&d.KE.isVoid(e,t)){let t=d.wA.next(i.path);e.children[t[0]]||(tJ("Adding placeholder block"),d.KE.insertNode(e,e.pteCreateTextBlock({decorators:[]})))}}t(i)},e}(f(l(h(s(m(e)))))))))))},tH=I("component:PortableTextEditor:SlateContainer"),tQ=new WeakMap,tF={lineBreak:e=>"Enter"===e.key&&e.shiftKey},tZ=(0,z.Ke)({on:"keyboard.keydown",guard:({event:e})=>tF.lineBreak(e.originEvent),actions:[()=>[(0,z.xl)({type:"insert.soft break"})]]}),tX=[(0,z.Ke)({on:"annotation.toggle",guard:({snapshot:e,event:t})=>(0,K.kK)(t.annotation.name)(e),actions:[({event:e})=>[(0,z.xl)({type:"annotation.remove",annotation:e.annotation})]]}),(0,z.Ke)({on:"annotation.toggle",guard:({snapshot:e,event:t})=>!(0,K.kK)(t.annotation.name)(e),actions:[({event:e})=>[(0,z.xl)({type:"annotation.add",annotation:e.annotation})]]})],t0=[(0,z.Ke)({on:"decorator.toggle",guard:({snapshot:e,event:t})=>(0,K.Y1)(t.decorator)(e),actions:[({event:e})=>[(0,z.xl)({type:"decorator.remove",decorator:e.decorator})]]}),(0,z.Ke)({on:"decorator.toggle",guard:({snapshot:e,event:t})=>{let n=t.offsets?(0,P.lv)({value:e.context.value,offsets:t.offsets}):null;return n?!(0,K.Y1)(t.decorator)({...e,context:{...e.context,selection:n}}):!(0,K.Y1)(t.decorator)(e)},actions:[({event:e})=>[(0,z.xl)({...e,type:"decorator.add"})]]})],t1=[(0,z.Ke)({on:"insert.blocks",guard:({event:e})=>"before"===e.placement,actions:[({event:e})=>e.blocks.map((e,t)=>(0,z.xl)({type:"insert.block",block:e,placement:0===t?"before":"after",select:"end"}))]}),(0,z.Ke)({on:"insert.blocks",guard:({event:e})=>"after"===e.placement,actions:[({event:e})=>e.blocks.map(e=>(0,z.xl)({type:"insert.block",block:e,placement:"after",select:"end"}))]}),(0,z.Ke)({on:"insert.blocks",guard:({snapshot:e,event:t})=>!("auto"!==t.placement||!(0,D.hH)(e)),actions:[({event:e})=>1===e.blocks.length?[(0,z.xl)({type:"insert.block",block:e.blocks[0],placement:"auto",select:"end"})]:e.blocks.flatMap((t,n)=>0===n?[(0,z.xl)({type:"insert.break"}),(0,z.xl)({type:"select.previous block",select:"end"}),(0,z.xl)({type:"insert.block",block:t,placement:"auto",select:"end"})]:n===e.blocks.length-1?[(0,z.xl)({type:"select.next block",select:"start"}),(0,z.xl)({type:"insert.block",block:t,placement:"auto",select:"end"})]:[(0,z.xl)({type:"insert.block",block:t,placement:"after",select:"end"})])]}),(0,z.Ke)({on:"insert.blocks",guard:({event:e})=>"auto"===e.placement,actions:[({event:e})=>e.blocks.map((e,t)=>(0,z.xl)({type:"insert.block",block:e,placement:0===t?"auto":"after",select:"end"}))]})],t2=[(0,z.Ke)({on:"list item.add",guard:({snapshot:e})=>({selectedTextBlocks:(0,K.Lw)(e)}),actions:[({event:e},{selectedTextBlocks:t})=>t.map(t=>(0,z.xl)({type:"block.set",at:t.path,props:{level:1,listItem:e.listItem}}))]}),(0,z.Ke)({on:"list item.remove",guard:({snapshot:e})=>({selectedTextBlocks:(0,K.Lw)(e)}),actions:[(e,{selectedTextBlocks:t})=>t.map(e=>(0,z.xl)({type:"block.unset",at:e.path,props:["level","listItem"]}))]}),(0,z.Ke)({on:"list item.toggle",guard:({snapshot:e,event:t})=>(0,K.oZ)(t.listItem)(e),actions:[({event:e})=>[(0,z.xl)({type:"list item.remove",listItem:e.listItem})]]}),(0,z.Ke)({on:"list item.toggle",guard:({snapshot:e,event:t})=>!(0,K.oZ)(t.listItem)(e),actions:[({event:e})=>[(0,z.xl)({type:"list item.add",listItem:e.listItem})]]})],t8=[(0,z.Ke)({on:"select.previous block",guard:({snapshot:e,event:t})=>{let n=(0,D.HA)(e);if(!n)return!1;let i="end"===t.select?(0,_.J8)(n):(0,_.u3)(n);return{selection:{anchor:i,focus:i}}},actions:[(e,{selection:t})=>[(0,z.xl)({type:"select",selection:t})]]}),(0,z.Ke)({on:"select.next block",guard:({snapshot:e,event:t})=>{let n=(0,D.RL)(e);if(!n)return!1;let i="end"===t.select?(0,_.J8)(n):(0,_.u3)(n);return{selection:{anchor:i,focus:i}}},actions:[(e,{selection:t})=>[(0,z.xl)({type:"select",selection:t})]]})],t3=[(0,z.Ke)({on:"style.add",guard:({snapshot:e})=>({selectedTextBlocks:(0,K.Lw)(e)}),actions:[({event:e},{selectedTextBlocks:t})=>t.map(t=>(0,z.xl)({type:"block.set",at:t.path,props:{style:e.style}}))]}),(0,z.Ke)({on:"style.remove",guard:({snapshot:e})=>({selectedTextBlocks:(0,K.Lw)(e)}),actions:[(e,{selectedTextBlocks:t})=>t.map(e=>(0,z.xl)({type:"block.unset",at:e.path,props:["style"]}))]}),(0,z.Ke)({on:"style.toggle",guard:({snapshot:e,event:t})=>(0,K.ER)(t.style)(e),actions:[({event:e})=>[(0,z.xl)({type:"style.remove",style:e.style})]]}),(0,z.Ke)({on:"style.toggle",guard:({snapshot:e,event:t})=>!(0,K.ER)(t.style)(e),actions:[({event:e})=>[(0,z.xl)({type:"style.add",style:e.style})]]})],t4=(0,z.Ke)({on:"deserialize",guard:({snapshot:e,event:t})=>{let n=e.context.converters.flatMap(n=>{let i=t.originEvent.originEvent.dataTransfer.getData(n.mimeType);return i?[n.deserialize({snapshot:e,event:{type:"deserialize",data:i}})]:[]});return n.find(e=>"deserialization.success"===e.type)||{type:"deserialization.failure",mimeType:"*/*",reason:n.map(e=>"deserialization.failure"===e.type?e.reason:"").join(", ")}},actions:[({event:e},t)=>[(0,z.xl)({...t,originEvent:e.originEvent})]]}),t6=(0,z.Ke)({on:"serialize",guard:({snapshot:e,event:t})=>{if(0===e.context.converters.length)return!1;let n=e.context.converters.map(n=>n.serialize({snapshot:e,event:{...t,originEvent:t.originEvent.type}}));return 0!==n.length&&n},actions:[({event:e},t)=>t.map(t=>(0,z.xl)({...t,originEvent:e.originEvent}))]}),t5=[(0,z.Ke)({on:"clipboard.copy",guard:({snapshot:e})=>{let t=(0,D.d2)(e),n=(0,D.WV)(e);return t&&n},actions:[()=>[{type:"noop"}]]}),(0,z.Ke)({on:"clipboard.copy",actions:[({event:e})=>[(0,z.xl)({type:"serialize",originEvent:e})]]}),(0,z.Ke)({on:"clipboard.cut",guard:({snapshot:e})=>{let t=(0,D.d2)(e),n=(0,D.WV)(e);return t&&n},actions:[()=>[{type:"noop"}]]}),(0,z.Ke)({on:"clipboard.cut",guard:({snapshot:e})=>!!e.context.selection&&{selection:e.context.selection},actions:[({event:e},{selection:t})=>[(0,z.xl)({type:"serialize",originEvent:e}),(0,z.xl)({type:"delete",selection:t})]]}),(0,z.Ke)({on:"drag.dragstart",actions:[({event:e})=>[(0,z.xl)({type:"serialize",originEvent:e})]]}),(0,z.Ke)({on:"serialization.success",actions:[({event:e})=>[{type:"effect",effect:()=>{e.originEvent.originEvent.dataTransfer.setData(e.mimeType,e.data)}}]]}),(0,z.Ke)({on:"serialization.failure",actions:[({event:e})=>[{type:"effect",effect:()=>{console.warn(`Serialization of ${e.mimeType} failed with reason "${e.reason}"`)}}]]}),(0,z.Ke)({on:"drag.drop",guard:({snapshot:e,event:t})=>{let n=e.beta.internalDrag?.origin,i=t.position.selection;return!!n&&(0,D.Q)(i)({...e,context:{...e.context,selection:n.selection}})},actions:[()=>[{type:"noop"}]]}),(0,z.Ke)({on:"drag.drop",actions:[({event:e})=>[(0,z.xl)({type:"select",selection:e.position.selection}),(0,z.xl)({type:"deserialize",originEvent:e})]]}),(0,z.Ke)({on:"deserialization.success",guard:({snapshot:e,event:t})=>{if("drag.drop"!==t.originEvent.type||void 0===e.beta.internalDrag)return!1;let n=e.beta.internalDrag.origin,i=t.originEvent.position.selection,r=!!n&&(0,D.Q)(i)({...e,context:{...e.context,selection:n.selection}}),o=(0,K.iE)({context:{...e.context,selection:n.selection}}),a=(0,D.wx)({context:{...e.context,selection:n.selection}});return!r&&{draggingEntireBlocks:o,draggedBlocks:a,dragOrigin:n,originEvent:t.originEvent}},actions:[({event:e},{draggingEntireBlocks:t,draggedBlocks:n,dragOrigin:i,originEvent:r})=>[...t?n.map(e=>(0,z.xl)({type:"delete.block",at:e.path})):[(0,z.xl)({type:"delete",selection:i.selection})],(0,z.xl)({type:"insert.blocks",blocks:e.data,placement:t?"start"===r.position.block?"before":"end"===r.position.block?"after":"auto":"auto"})]]}),(0,z.Ke)({on:"deserialization.success",guard:({snapshot:e,event:t})=>{if((0,D.hH)(e)&&"text/plain"===t.mimeType&&"clipboard.paste"===t.originEvent.type){let n=e.context.activeDecorators;return{activeAnnotations:(0,K.Bg)(e),activeDecorators:n,textRuns:t.data.flatMap(t=>(0,x.zS)(e.context.schema,t)?[(0,_.so)(t)]:[])}}return!1},actions:[(e,{activeAnnotations:t,activeDecorators:n,textRuns:i})=>i.flatMap((e,r)=>r!==i.length-1?[(0,z.xl)({type:"insert.span",text:e,decorators:n,annotations:t.map(({_key:e,_type:t,...n})=>({name:t,value:n}))}),(0,z.xl)({type:"insert.break"})]:[(0,z.xl)({type:"insert.span",text:e,decorators:n,annotations:t.map(({_key:e,_type:t,...n})=>({name:t,value:n}))})])]}),(0,z.Ke)({on:"deserialization.success",actions:[({event:e})=>[(0,z.xl)({type:"insert.blocks",blocks:e.data,placement:"auto"})]]}),(0,z.Ke)({on:"deserialization.failure",actions:[({event:e})=>[{type:"effect",effect:()=>{console.warn(`Deserialization of ${e.mimeType} failed with reason "${e.reason}"`)}}]]}),(0,z.Ke)({on:"clipboard.paste",guard:({snapshot:e})=>!!(e.context.selection&&(0,D.gR)(e))&&{selection:e.context.selection},actions:[({event:e},{selection:t})=>[(0,z.xl)({type:"delete",selection:t}),(0,z.xl)({type:"deserialize",originEvent:e})]]}),(0,z.Ke)({on:"clipboard.paste",actions:[({event:e})=>[(0,z.xl)({type:"deserialize",originEvent:e})]]}),(0,z.Ke)({on:"input.*",actions:[({event:e})=>[(0,z.xl)({type:"deserialize",originEvent:e})]]}),...tX,...t0,...t1,...t2,...t3,...t8,t4,t6,tZ];function t9(e){return"deserialize"===e.type||e.type.startsWith("deserialization.")||"insert.blocks"===e.type||e.type.startsWith("list item.")||"serialize"===e.type||e.type.startsWith("serialization.")||"select.next block"===e.type||"select.previous block"===e.type||e.type.startsWith("style.")}function t7(e){return e.type.startsWith("clipboard.")||e.type.startsWith("drag.")||e.type.startsWith("input.")||e.type.startsWith("keyboard.")||e.type.startsWith("mouse.")}function ne(e){return e.type.startsWith("custom.")}let nt=I("behaviors:event");function nn({schema:e,slateEditorInstance:t}){let n=e.decorators.map(e=>e.value);return(({...d.KE.marks(t)??{}}).marks??[]).filter(e=>n.includes(e))}let ni=(0,h.mj)({types:{context:{},events:{},emitted:{},input:{},tags:{}},actions:{"add behavior to context":(0,p.a)({behaviors:({context:e,event:t})=>((0,h.DT)(t,"add behavior"),new Set([...e.behaviors,t.behavior]))}),"remove behavior from context":(0,p.a)({behaviors:({context:e,event:t})=>((0,h.DT)(t,"remove behavior"),e.behaviors.delete(t.behavior),new Set([...e.behaviors]))}),"assign behaviors":(0,p.a)({behaviors:({event:e})=>((0,h.DT)(e,"update behaviors"),new Set([...e.behaviors]))}),"assign schema":(0,p.a)({schema:({event:e})=>((0,h.DT)(e,"update schema"),e.schema)}),"emit patch event":(0,p.b)(({event:e,enqueue:t})=>{(0,h.DT)(e,"internal.patch"),t.emit(e),t.emit({type:"patch",patch:e.patch})}),"emit mutation event":(0,p.e)(({event:e})=>((0,h.DT)(e,"mutation"),e)),"emit read only":(0,p.e)({type:"read only"}),"emit editable":(0,p.e)({type:"editable"}),"defer event":(0,p.a)({pendingEvents:({context:e,event:t})=>((0,h.DT)(t,["internal.patch","mutation"]),[...e.pendingEvents,t])}),"emit pending events":(0,p.b)(({context:e,enqueue:t})=>{for(let n of e.pendingEvents)"internal.patch"===n.type?(t.emit(n),t.emit({type:"patch",patch:n.patch})):t.emit(n)}),"emit ready":(0,p.e)({type:"ready"}),"clear pending events":(0,p.a)({pendingEvents:[]}),"handle behavior event":({context:e,event:t,self:n})=>{(0,h.DT)(t,["behavior event","custom behavior event"]),function e({behaviors:t,event:n,editor:i,keyGenerator:r,schema:o,getSnapshot:a,nativeEvent:s,defaultActionCallback:l}){nt(`(${t7(n)?"native":t9(n)?"internal":ne(n)?"custom":"synthetic"})`,JSON.stringify(n,null,2));let c=ne(n)||t7(n)||t9(n)?void 0:{...n,editor:i},d=t.filter(e=>{if("*"===e.on)return!0;let[t]=e.on.includes("*")&&e.on.includes(".")?e.on.split("."):[void 0],[i]=n.type.includes(".")?n.type.split("."):[void 0];return void 0!==t&&void 0!==i&&t===i||void 0!==t&&void 0===i&&t===n.type||e.on===n.type});if(0===d.length){if(l){tt(i,()=>{try{l()}catch(e){console.error(Error(`Performing action "${n.type}" failed due to: ${e.message}`))}});return}if(!c)return;tt(i,()=>{try{tM({context:{keyGenerator:r,schema:o},action:c})}catch(e){console.error(Error(`Performing action "${c.type}" as a result of "${n.type}" failed due to: ${e.message}`))}}),i.onChange();return}let h=a(),p=!1;for(let l of d){let c=void 0===l.guard||l.guard({context:h.context,snapshot:h,event:n});if(c){for(let s of l.actions.map(e=>e({context:h.context,snapshot:h,event:n},c)))0!==s.length&&(p=p||s.some(e=>"effect"!==e.type),function(e,t){let n=ti.get(e);if(n){tt(e,t);return}ti.set(e,n??{actionSetId:e9()}),tt(e,t),ti.set(e,void 0)}(i,()=>{for(let l of s){if("raise"===l.type){e({behaviors:t,event:l.event,editor:i,keyGenerator:r,schema:o,getSnapshot:a,defaultActionCallback:void 0,nativeEvent:void 0});continue}let s={...l,editor:i};try{tM({context:{keyGenerator:r,schema:o},action:s})}catch(e){console.error(Error(`Performing action "${s.type}" as a result of "${n.type}" failed due to: ${e.message}`));break}}}),i.onChange());if(p){s?.preventDefault();break}}}if(!p){if(l){tt(i,()=>{try{l()}catch(e){console.error(Error(`Performing "${n.type}" failed due to: ${e.message}`))}});return}if(!c)return;tt(i,()=>{try{tM({context:{keyGenerator:r,schema:o},action:c})}catch(e){console.error(Error(`Performing action "${c.type}" as a result of "${n.type}" failed due to: ${e.message}`))}}),i.onChange()}}({behaviors:[...e.behaviors.values(),...t5],event:t.behaviorEvent,editor:t.editor,keyGenerator:e.keyGenerator,schema:e.schema,getSnapshot:()=>(function({converters:e,editor:t,keyGenerator:n,readOnly:i,schema:r,hasTag:o,internalDrag:a}){let s=H(t.children,r.block.name,eo.get(t)),l=U(s,t.selection,r);return{context:{activeDecorators:nn({schema:r,slateEditorInstance:t}),converters:e,keyGenerator:n,readOnly:i,schema:r,selection:l,value:s},beta:{hasTag:o,internalDrag:a}}})({converters:[...e.converters],editor:t.editor,keyGenerator:e.keyGenerator,readOnly:n.getSnapshot().matches({"edit mode":"read only"}),schema:e.schema,hasTag:e=>n.getSnapshot().hasTag(e),internalDrag:e.internalDrag}),nativeEvent:t.nativeEvent,defaultActionCallback:"behavior event"===t.type?t.defaultActionCallback:void 0})}}}).createMachine({id:"editor",context:({input:e})=>({behaviors:new Set([...e.behaviors??z.Zy]),converters:new Set(e.converters??[]),keyGenerator:e.keyGenerator,pendingEvents:[],schema:e.schema,selection:null,initialReadOnly:e.readOnly??!1,maxBlocks:e.maxBlocks,value:e.value}),on:{"notify.blurred":{actions:(0,p.e)(({event:e})=>({...e,type:"blurred"}))},"notify.done loading":{actions:(0,p.e)({type:"done loading"})},"notify.error":{actions:(0,p.e)(({event:e})=>({...e,type:"error"}))},"notify.invalid value":{actions:(0,p.e)(({event:e})=>({...e,type:"invalid value"}))},"notify.focused":{actions:(0,p.e)(({event:e})=>({...e,type:"focused"}))},"notify.selection":{actions:[(0,p.a)({selection:({event:e})=>e.selection}),(0,p.e)(({event:e})=>({...e,type:"selection"}))]},"notify.unset":{actions:(0,p.e)(({event:e})=>({...e,type:"unset"}))},"notify.loading":{actions:(0,p.e)({type:"loading"})},"notify.value changed":{actions:(0,p.e)(({event:e})=>({...e,type:"value changed"}))},"add behavior":{actions:"add behavior to context"},"remove behavior":{actions:"remove behavior from context"},patches:{actions:(0,p.e)(({event:e})=>e)},"update behaviors":{actions:"assign behaviors"},"update key generator":{actions:(0,p.a)({keyGenerator:({event:e})=>e.keyGenerator})},"update schema":{actions:"assign schema"},"update value":{actions:(0,p.a)({value:({event:e})=>e.value})},"update maxBlocks":{actions:(0,p.a)({maxBlocks:({event:e})=>e.maxBlocks})}},type:"parallel",states:{"edit mode":{initial:"read only",states:{"read only":{initial:"determine initial edit mode",on:{"behavior event":{actions:"handle behavior event",guard:({event:e})=>"clipboard.copy"===e.behaviorEvent.type||"serialize"===e.behaviorEvent.type||"serialization.failure"===e.behaviorEvent.type||"serialization.success"===e.behaviorEvent.type||"select"===e.behaviorEvent.type}},states:{"determine initial edit mode":{on:{"done syncing initial value":[{target:"#editor.edit mode.read only.read only",guard:({context:e})=>e.initialReadOnly},{target:"#editor.edit mode.editable"}]}},"read only":{on:{"update readOnly":{guard:({event:e})=>!e.readOnly,target:"#editor.edit mode.editable",actions:["emit editable"]}}}}},editable:{on:{"update readOnly":{guard:({event:e})=>e.readOnly,target:"#editor.edit mode.read only.read only",actions:["emit read only"]},"behavior event":{actions:"handle behavior event"},"custom behavior event":{actions:"handle behavior event"},"annotation.*":{actions:(0,p.e)(({event:e})=>e)},"block.*":{actions:(0,p.e)(({event:e})=>e)},blur:{actions:(0,p.e)(({event:e})=>e)},"custom.*":{actions:(0,p.e)(({event:e})=>({type:"custom.*",event:e}))},"decorator.*":{actions:(0,p.e)(({event:e})=>e)},"delete.*":{actions:(0,p.e)(({event:e})=>e)},focus:{actions:(0,p.e)(({event:e})=>e)},"history.*":{actions:(0,p.e)(({event:e})=>e)},"insert.*":{actions:(0,p.e)(({event:e})=>e)},"list item.*":{actions:(0,p.e)(({event:e})=>e)},"move.*":{actions:(0,p.e)(({event:e})=>e)},select:{actions:(0,p.e)(({event:e})=>e)},"select.*":{actions:(0,p.e)(({event:e})=>e)},"style.*":{actions:(0,p.e)(({event:e})=>e)},"text block.*":{actions:(0,p.e)(({event:e})=>e)}},initial:"idle",states:{idle:{on:{dragstart:{actions:[(0,p.a)({internalDrag:({event:e})=>({ghost:e.ghost,origin:e.origin})})],target:"dragging internally"}}},"dragging internally":{exit:[({context:e})=>{if(e.internalDrag?.ghost)try{e.internalDrag.ghost.parentNode?.removeChild(e.internalDrag.ghost)}catch(e){console.error(Error(`Removing the internal drag ghost failed due to: ${e.message}`))}},(0,p.a)({internalDrag:void 0})],tags:["dragging internally"],on:{dragend:{target:"idle"},drop:{target:"idle"}}}}}}},setup:{initial:"setting up",states:{"setting up":{exit:["emit ready"],on:{"internal.patch":{actions:"defer event"},mutation:{actions:"defer event"},"done syncing initial value":{target:"pristine"}}},pristine:{initial:"idle",states:{idle:{on:{normalizing:{target:"normalizing"},"internal.patch":{actions:"defer event",target:"#editor.setup.dirty"},mutation:{actions:"defer event",target:"#editor.setup.dirty"}}},normalizing:{on:{"done normalizing":{target:"idle"},"internal.patch":{actions:"defer event"},mutation:{actions:"defer event"}}}}},dirty:{entry:["emit pending events","clear pending events"],on:{"internal.patch":{actions:"emit patch event"},mutation:{actions:"emit mutation event"}}}}}}});function nr({editorActorSnapshot:e,slateEditorInstance:t}){return{context:{converters:[...e.context.converters],activeDecorators:nn({schema:e.context.schema,slateEditorInstance:t}),keyGenerator:e.context.keyGenerator,readOnly:e.matches({"edit mode":"read only"}),schema:e.context.schema,selection:e.context.selection,value:function({editorActorSnapshot:e,slateEditorInstance:t}){return H(t.children,e.context.schema.block.name,eo.get(t))}({editorActorSnapshot:e,slateEditorInstance:t})},beta:{hasTag:t=>e.hasTag(t),internalDrag:e.context.internalDrag}}}function no(e){return{behaviors:e.behaviors,converters:tT,keyGenerator:e.keyGenerator??e9,maxBlocks:e.maxBlocks,readOnly:e.readOnly,schema:e.schemaDefinition?function(e){let t=e?.blockObjects?.map(e=>y.U8({type:"object",name:"image"===e.name?"tmp-image":e.name,title:"image"===e.name&&void 0===e.title?"Image":e.title,fields:[]}))??[],n=e?.inlineObjects?.map(e=>y.U8({type:"object",name:e.name,title:e.title,fields:[]}))??[],i=(0,y.MI)({type:"array",name:"portable-text",of:[...t.map(e=>({type:e.name})),{type:"block",name:"block",of:n.map(e=>({type:e.name})),marks:{decorators:e?.decorators?.map(e=>({title:e.title??C(e.name),value:e.name}))??[],annotations:e?.annotations?.map(e=>({name:e.name,type:"object",title:e.title}))??[]},lists:e?.lists?.map(e=>({value:e.name,title:e.title??C(e.name)}))??[],styles:e?.styles?.map(e=>({value:e.name,title:e.title??C(e.name)}))??[]}]}),r=M(B.S.compile({types:[i,...t,...n]}).get("portable-text"));return{...r,blockObjects:r.blockObjects.map(e=>"tmp-image"===e.name?{...e,name:"image",type:{...e.type,name:"image"}}:e)}}(e.schemaDefinition):M(e.schema.hasOwnProperty("jsonType")?e.schema:ed(e.schema)),value:e.initialValue}}function na(e){let t=function(e){let t=tQ.get(e.editorActor);if(t)return tH("Reusing existing Slate editor instance",e.editorActor.id),t;tH("Creating new Slate editor instance",e.editorActor.id);let n=[],i=[],r=tq((0,a.o$)((0,d.ie)()),{editorActor:e.editorActor,subscriptions:i});for(let e of(eo.set(r,{}),er.set(r,{}),i))n.push(e());let o=[r.pteCreateTextBlock({decorators:[]})],s={instance:r,initialValue:o};return tQ.set(e.editorActor,s),s}({editorActor:e});return{getSnapshot:()=>nr({editorActorSnapshot:e.getSnapshot(),slateEditorInstance:t.instance}),registerBehavior:t=>(e.send({type:"add behavior",behavior:t.behavior}),()=>{e.send({type:"remove behavior",behavior:t.behavior})}),send:t=>{e.send(t)},on:(t,n)=>e.on(t,e=>{switch(e.type){case"blurred":case"done loading":case"editable":case"error":case"focused":case"invalid value":case"loading":case"mutation":case"patch":case"read only":case"ready":case"selection":case"value changed":n(e)}}),_internal:{editable:function(e,t){let n=t.getSnapshot().context.schema;return{focus:()=>{t.send({type:"behavior event",behaviorEvent:{type:"focus"},editor:e})},blur:()=>{t.send({type:"behavior event",behaviorEvent:{type:"blur"},editor:e})},toggleMark:n=>{t.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:n},editor:e})},toggleList:n=>{t.send({type:"behavior event",behaviorEvent:{type:"list item.toggle",listItem:n},editor:e})},toggleBlockStyle:n=>{t.send({type:"behavior event",behaviorEvent:{type:"style.toggle",style:n},editor:e})},isMarkActive:t=>{try{return function({editor:e,decorator:t}){if(!e.selection)return!1;let n=Array.from(d.KE.nodes(e,{match:d.EY.isText,at:e.selection}));return 0!==n.length&&(d.Q6.isExpanded(e.selection)?n.every(e=>{let[n]=e;return n.marks?.includes(t)}):(({...d.KE.marks(e)||{}}).marks||[]).includes(t))}({editor:e,decorator:t})}catch(e){return console.warn(e),!1}},marks:()=>({...d.KE.marks(e)||{}}).marks||[],undo:()=>{t.send({type:"behavior event",behaviorEvent:{type:"history.undo"},editor:e})},redo:()=>{t.send({type:"behavior event",behaviorEvent:{type:"history.redo"},editor:e})},select:t=>{let n=V(t,e);n?d.gB.select(e,n):d.gB.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection){let t=d.bP.descendant(e,e.selection.focus.path.slice(0,1));if(t)return H([t],n.block.name,eo.get(e))[0]}},focusChild:()=>{if(e.selection){let t=d.bP.descendant(e,e.selection.focus.path.slice(0,1));if(t&&e.isTextBlock(t))return H([t],n.block.name,eo.get(e))[0].children[e.selection.focus.path[1]]}},insertChild:(i,r)=>{if(i.name!==n.span.name)return t.send({type:"behavior event",behaviorEvent:{type:"insert.inline object",inlineObject:{name:i.name,value:r}},editor:e}),U(H(e.children,n.block.name,eo.get(e)),e.selection,n)?.focus.path??[];if(!e.selection)throw Error("The editor has no selection");let[o]=Array.from(d.KE.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===n.block.name}))[0]||[void 0];if(!o)throw Error("No focused text block");if(i.name!==n.span.name&&!n.inlineObjects.some(e=>e.name===i.name))throw Error("This type cannot be inserted as a child to a text block");let a=q([{_key:t.getSnapshot().context.keyGenerator(),_type:n.block.name,children:[{_key:t.getSnapshot().context.keyGenerator(),_type:i.name,...r||{}}]}],{schemaTypes:t.getSnapshot().context.schema})[0].children[0],s=e.selection.focus.path.slice(0,2),l=a._type===n.span.name,c=d.bP.get(e,s);return l&&c._type!==n.span.name&&(tC("Inserting span child next to inline object child, moving selection + 1"),e.move({distance:1,unit:"character"})),d.gB.insertNodes(e,a,{select:!0,at:e.selection}),e.onChange(),U(H(e.children,n.block.name,eo.get(e)),e.selection,n)?.focus.path||[]},insertBlock:(i,r)=>(t.send({type:"behavior event",behaviorEvent:{type:"insert.block",block:{_type:i.name,...r||{}},placement:"auto"},editor:e}),U(H(e.children,n.block.name,eo.get(e)),e.selection,n)?.focus.path??[]),hasBlockStyle:t=>{try{return function({editor:e,style:t}){if(!e.selection)return!1;let n=[...d.KE.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([e])=>e.style===t)}({editor:e,style:t})}catch{return!1}},hasListStyle:t=>{try{return function({editor:e,listItem:t}){if(!e.selection)return!1;let n=[...d.KE.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([n])=>e.isListBlock(n)&&n.listItem===t)}({editor:e,listItem:t})}catch{return!1}},isVoid:e=>![n.block.name,n.span.name].includes(e._type),findByPath:t=>{let i=V({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(i){let[r,o]=d.KE.node(e,i.focus.path.slice(0,1));if(r&&o&&"string"==typeof r._key){if(1===t.length&&1===i.focus.path.length)return[H([r],n.block.name)[0],[{_key:r._key}]];let o=H([r],n.block.name,eo.get(e))[0];if(e.isTextBlock(o)){let e=o.children[i.focus.path[1]];if(e)return[e,[{_key:r._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[i]=Array.from(d.KE.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=a.rL.toDOMNode(e,i)}catch{}return n},activeAnnotations:()=>{if(!e.selection||e.selection.focus.path.length<2)return[];try{let t=[];for(let[n,i]of d.KE.nodes(e,{at:e.selection,match:e=>d.EY.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})){let[r]=d.KE.node(e,i,{depth:1});e.isTextBlock(r)&&r.markDefs?.forEach(e=>{d.EY.isText(n)&&n.marks&&Array.isArray(n.marks)&&n.marks.includes(e._key)&&t.push(e)})}return t}catch{return[]}},isAnnotationActive:t=>(function({editor:e,annotation:t}){if(!e.selection||e.selection.focus.path.length<2)return!1;try{let n=[...d.KE.nodes(e,{at:e.selection,match:e=>d.EY.isText(e)})];if(0===n.length||n.some(([e])=>!(0,y.bn)(e)||!e.marks||e.marks?.length===0))return!1;let i=n.reduce((t,[,n])=>{let[i]=d.KE.node(e,n,{depth:1});return e.isTextBlock(i)&&i.markDefs?[...t,...i.markDefs]:t},[]);return n.every(([e])=>!!(0,y.bn)(e)&&e.marks?.map(e=>i.find(t=>t?._key===e)?._type)?.includes(t.name))}catch{return!1}})({editor:e,annotation:{name:t}}),addAnnotation:(i,r)=>{let o;return d.KE.withoutNormalizing(e,()=>{o=tz({context:{keyGenerator:t.getSnapshot().context.keyGenerator,schema:n},action:{annotation:{name:i.name,value:r??{}},editor:e}})}),e.onChange(),o},delete:(t,i)=>{if(t){let r=V(t,e);if(!(r&&r.anchor.path.length>0&&r.focus.path.length>0))throw Error("Invalid range");if(r){if(!i?.mode||i?.mode==="selected"){tC("Deleting content in selection"),d.gB.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}i?.mode==="blocks"&&(tC("Deleting blocks touched by selection"),d.gB.removeNodes(e,{at:r,voids:!0,match:t=>e.isTextBlock(t)||!e.isTextBlock(t)&&d.Hg.isElement(t)})),i?.mode==="children"&&(tC("Deleting children touched by selection"),d.gB.removeNodes(e,{at:r,voids:!0,match:t=>t._type===n.span.name||!e.isTextBlock(t)&&d.Hg.isElement(t)})),0===e.children.length&&(e.children=[e.pteCreateTextBlock({decorators:[]})]),e.onChange()}}},removeAnnotation:n=>{t.send({type:"behavior event",behaviorEvent:{type:"annotation.remove",annotation:{name:n.name}},editor:e})},getSelection:()=>{let t=null;if(e.selection){let i=ea.get(e.selection);if(i)return i;t=U(H(e.children,n.block.name,eo.get(e)),e.selection,n),ea.set(e.selection,t)}return t},getValue:()=>H(e.children,n.block.name,eo.get(e)),isCollapsedSelection:()=>!!e.selection&&d.Q6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&d.Q6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()},getFragment:()=>H(e.getFragment(),n.block.name),isSelectionsOverlapping:(t,n)=>{let i=V(t,e),r=V(n,e);return d.Q6.isRange(i)&&d.Q6.isRange(r)&&d.Q6.includes(i,r)}}}(t.instance,e),editorActor:e,slateEditor:t}}}let ns=(0,o.createContext)(null),nl=()=>{let e=(0,o.useContext)(ns);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},nc=I("component:PortableTextEditor:SelectionProvider");function nd(e){let t,n,a;let s=(0,r.c)(6),[l,c]=(0,o.useState)(null);return s[0]!==e.editorActor?(t=()=>{nc("Subscribing to selection changes");let t=e.editorActor.on("selection",e=>{(0,o.startTransition)(()=>{c(e.selection)})});return()=>{nc("Unsubscribing to selection changes"),t.unsubscribe()}},n=[e.editorActor],s[0]=e.editorActor,s[1]=t,s[2]=n):(t=s[1],n=s[2]),(0,o.useEffect)(t,n),s[3]!==e.children||s[4]!==l?(a=(0,i.jsx)(ns.Provider,{value:l,children:e.children}),s[3]=e.children,s[4]=l,s[5]=a):a=s[5],a}let nh=I("component:PortableTextEditor");class np extends o.Component{static displayName="PortableTextEditor";change$=new $.B;constructor(e){super(e),e.editor?this.editor=e.editor:this.editor=function(e){let t=(0,f.A)(ni,{input:no(e)});return t.start(),na(t)}({keyGenerator:e.keyGenerator??e9,schema:e.schemaType,initialValue:e.value,maxBlocks:void 0===e.maxBlocks?void 0:Number.parseInt(e.maxBlocks.toString(),10),readOnly:e.readOnly}),this.schemaTypes=this.editor._internal.editorActor.getSnapshot().context.schema,this.editable=this.editor._internal.editable}componentDidUpdate(e){this.props.editor||e.editor||this.props.schemaType===e.schemaType||(this.schemaTypes=M(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:ed(this.props.schemaType)),this.editor._internal.editorActor.send({type:"update schema",schema:this.schemaTypes})),this.props.editor||e.editor||(this.props.readOnly!==e.readOnly&&this.editor._internal.editorActor.send({type:"update readOnly",readOnly:this.props.readOnly??!1}),this.props.maxBlocks!==e.maxBlocks&&this.editor._internal.editorActor.send({type:"update maxBlocks",maxBlocks:void 0===this.props.maxBlocks?void 0:Number.parseInt(this.props.maxBlocks.toString(),10)}),this.props.value!==e.value&&this.editor._internal.editorActor.send({type:"update value",value:this.props.value}),this.props.editorRef!==e.editorRef&&this.props.editorRef&&(this.props.editorRef.current=this))}setEditable=e=>{this.editor._internal.editable={...this.editor._internal.editable,...e}};render(){let e=this.props.editor?void 0:this.props.incomingPatches$??this.props.patches$;return(0,i.jsxs)(i.Fragment,{children:[e?(0,i.jsx)(nu,{editorActor:this.editor._internal.editorActor,patches$:e}):null,(0,i.jsx)(nf,{editorActor:this.editor._internal.editorActor,onChange:e=>{this.props.editor||this.props.onChange(e),this.change$.next(e)}}),(0,i.jsx)(t_,{editorActor:this.editor._internal.editorActor,slateEditor:this.editor._internal.slateEditor.instance}),(0,i.jsx)(es.Provider,{value:this.editor._internal.editorActor,children:(0,i.jsx)(a.A,{editor:this.editor._internal.slateEditor.instance,initialValue:this.editor._internal.slateEditor.initialValue,children:(0,i.jsx)(el.Provider,{value:this,children:(0,i.jsx)(nd,{editorActor:this.editor._internal.editorActor,children:this.props.children})})})})]})}static activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[];static isAnnotationActive=(e,t)=>!!e&&!!e.editable&&e.editable.isAnnotationActive(t);static addAnnotation=(e,t,n)=>e.editable?.addAnnotation(t,n);static blur=e=>{nh("Host blurred"),e.editable?.blur()};static delete=(e,t,n)=>e.editable?.delete(t,n);static findDOMNode=(e,t)=>e.editable?.findDOMNode(t);static findByPath=(e,t)=>e.editable?.findByPath(t)||[];static focus=e=>{nh("Host requesting focus"),e.editable?.focus()};static focusBlock=e=>e.editable?.focusBlock();static focusChild=e=>e.editable?.focusChild();static getSelection=e=>e.editable?e.editable.getSelection():null;static getValue=e=>e.editable?.getValue();static hasBlockStyle=(e,t)=>e.editable?.hasBlockStyle(t);static hasListStyle=(e,t)=>e.editable?.hasListStyle(t);static isCollapsedSelection=e=>e.editable?.isCollapsedSelection();static isExpandedSelection=e=>e.editable?.isExpandedSelection();static isMarkActive=(e,t)=>e.editable?.isMarkActive(t);static insertChild=(e,t,n)=>(nh("Host inserting child"),e.editable?.insertChild(t,n));static insertBlock=(e,t,n)=>e.editable?.insertBlock(t,n);static insertBreak=e=>e.editable?.insertBreak();static isVoid=(e,t)=>e.editable?.isVoid(t);static isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1];return t.length>1&&"children"!==t[1]||n};static marks=e=>e.editable?.marks();static select=(e,t)=>{nh("Host setting selection",t),e.editable?.select(t)};static removeAnnotation=(e,t)=>e.editable?.removeAnnotation(t);static toggleBlockStyle=(e,t)=>(nh("Host is toggling block style"),e.editable?.toggleBlockStyle(t));static toggleList=(e,t)=>e.editable?.toggleList(t);static toggleMark=(e,t)=>{nh("Host toggling mark",t),e.editable?.toggleMark(t)};static getFragment=e=>e.editable?.getFragment();static undo=e=>{nh("Host undoing"),e.editable?.undo()};static redo=e=>{nh("Host redoing"),e.editable?.redo()};static isSelectionsOverlapping=(e,t,n)=>e.editable?.isSelectionsOverlapping(t,n)}function nu(e){let t,n;let i=(0,r.c)(4);return i[0]!==e.editorActor||i[1]!==e.patches$?(t=()=>{let t=e.patches$.subscribe(t=>{e.editorActor.send({type:"patches",...t})});return()=>{t.unsubscribe()}},n=[e.editorActor,e.patches$],i[0]=e.editorActor,i[1]=e.patches$,i[2]=t,i[3]=n):(t=i[2],n=i[3]),(0,o.useEffect)(t,n),null}function nf(e){let t,n,i;let a=(0,r.c)(7);a[0]!==e?(t=t=>e.onChange(t),a[0]=e,a[1]=t):t=a[1];let s=(0,j.J)(t);return a[2]!==s||a[3]!==e.editorActor?(n=()=>{nh("Subscribing to editor changes");let t=e.editorActor.on("*",e=>{switch(e.type){case"blurred":s({type:"blur",event:e.event});break;case"patch":case"mutation":case"ready":case"selection":case"unset":s(e);break;case"loading":s({type:"loading",isLoading:!0});break;case"done loading":s({type:"loading",isLoading:!1});break;case"focused":s({type:"focus",event:e.event});break;case"value changed":s({type:"value",value:e.value});break;case"invalid value":s({type:"invalidValue",resolution:e.resolution,value:e.value});break;case"error":s({...e,level:"warning"})}});return()=>{nh("Unsubscribing to changes"),t.unsubscribe()}},a[2]=s,a[3]=e.editorActor,a[4]=n):n=a[4],a[5]!==e.editorActor?(i=[e.editorActor],a[5]=e.editorActor,a[6]=i):i=a[6],(0,o.useEffect)(n,i),null}let ng=o.createContext(void 0);function ny(e){let t,n,o,l,c,d,h,p,u,f;let g=(0,r.c)(28),y=function(e){let t,n,i,o;let a=(0,r.c)(6);a[0]!==e?(t=no(e),a[0]=e,a[1]=t):t=a[1],a[2]!==t?(n={input:t},a[2]=t,a[3]=n):n=a[3];let l=(0,s.qf)(ni,n);return a[4]!==l?(o=na(l),a[4]=l,a[5]=o):o=a[5],o}(e.initialConfig),m=y._internal.editorActor,k=y._internal.slateEditor;return g[0]!==y?(n=new np({editor:y}),g[0]=y,g[1]=n):n=g[1],t=n,g[2]!==t.change$?(o=e=>{t.change$.next(e)},g[2]=t.change$,g[3]=o):o=g[3],g[4]!==m||g[5]!==o?(l=(0,i.jsx)(nf,{editorActor:m,onChange:o}),g[4]=m,g[5]=o,g[6]=l):l=g[6],g[7]!==m||g[8]!==k.instance?(c=(0,i.jsx)(t_,{editorActor:m,slateEditor:k.instance}),g[7]=m,g[8]=k.instance,g[9]=c):c=g[9],g[10]!==m||g[11]!==e.children?(d=(0,i.jsx)(nd,{editorActor:m,children:e.children}),g[10]=m,g[11]=e.children,g[12]=d):d=g[12],g[13]!==t||g[14]!==d?(h=(0,i.jsx)(el.Provider,{value:t,children:d}),g[13]=t,g[14]=d,g[15]=h):h=g[15],g[16]!==k.initialValue||g[17]!==k.instance||g[18]!==h?(p=(0,i.jsx)(a.A,{editor:k.instance,initialValue:k.initialValue,children:h}),g[16]=k.initialValue,g[17]=k.instance,g[18]=h,g[19]=p):p=g[19],g[20]!==m||g[21]!==p?(u=(0,i.jsx)(es.Provider,{value:m,children:p}),g[20]=m,g[21]=p,g[22]=u):u=g[22],g[23]!==y||g[24]!==l||g[25]!==c||g[26]!==u?(f=(0,i.jsxs)(ng.Provider,{value:y,children:[l,c,u]}),g[23]=y,g[24]=l,g[25]=c,g[26]=u,g[27]=f):f=g[27],f}function nm(){let e=o.useContext(ng);if(!e)throw Error("No Editor set. Use EditorProvider to set one.");return e}}}]);